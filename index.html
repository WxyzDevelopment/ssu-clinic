<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SSU Digital Health Records Management System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="16x16" href="https://wxyzofficial.sirv.com/USC-Election/ssu.jpg">
    <link rel="icon" type="image/png" sizes="32x32" href="https://wxyzofficial.sirv.com/USC-Election/ssu.jpg">
    <link rel="apple-touch-icon" sizes="180x180" href="https://wxyzofficial.sirv.com/USC-Election/ssu.jpg">
    <link rel="shortcut icon" href="https://wxyzofficial.sirv.com/USC-Election/ssu.jpg">
    <meta name="theme-color" content="#2196F3">
    <meta name="application-name" content="DHRM System">
    <meta name="apple-mobile-web-app-title" content="DHRM System">


    <style>
        /* ===== CSS Variables & Reset ===== */
        :root {
            --primary-blue: #1a73e8;
            --secondary-blue: #4285f4;
            --light-blue: #e8f0fe;
            --accent-yellow: #fbbc04;
            --accent-red: #ea4335;
            --accent-green: #34a853;
            --text-dark: #202124;
            --text-light: #5f6368;
            --bg-white: #ffffff;
            --bg-gray: #f8f9fa;
            --border-color: #dadce0;
            --shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --shadow-lg: 0 4px 12px rgba(0,0,0,0.15);
            --radius: 8px;
            --radius-lg: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Roboto', sans-serif;
        }
        
        body {
            background-color: var(--bg-gray);
            color: var(--text-dark);
            line-height: 1.6;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(26, 115, 232, 0.9), rgba(66, 133, 244, 0.9)), 
                        url('https://wxyzofficial.sirv.com/USC-Election/ssu-view.jpg') center/cover no-repeat;
            background-attachment: fixed;
            z-index: -1;
            filter: blur(5px);
        }
        
        /* ===== Layout ===== */
        .container {
            display: flex;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }
        
        /* ===== Sidebar ===== */
        .sidebar {
            width: 250px;
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            z-index: 10;
            backdrop-filter: blur(10px);
        }
        
        .logo-container {
            padding: 24px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
            background-color: rgba(255, 255, 255, 0.8);
        }
        
        .logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid var(--primary-blue);
        }
        
        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .logo-text h2 {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-blue);
        }
        
        .logo-text p {
            font-size: 12px;
            color: var(--text-light);
        }
        
        .nav-menu {
            padding: 20px 0;
            flex-grow: 1;
        }
        
        .nav-item {
            padding: 14px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            color: var(--text-light);
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .nav-item:hover {
            background-color: var(--light-blue);
            color: var(--primary-blue);
        }
        
        .nav-item.active {
            background-color: var(--light-blue);
            color: var(--primary-blue);
            border-right: 4px solid var(--primary-blue);
        }
        
        .nav-icon {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
        
        .user-profile {
            padding: 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
            background-color: rgba(255, 255, 255, 0.8);
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
        }
        
        .user-info h4 {
            font-size: 14px;
            font-weight: 500;
        }
        
        .user-info p {
            font-size: 12px;
            color: var(--text-light);
        }
        
        .logout-btn {
            margin-left: auto;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 16px;
        }
        
        /* ===== Main Content ===== */
        .main-content {
            flex-grow: 1;
            padding: 24px;
            overflow-y: auto;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-dark);
        }
        
        .date-display {
            color: var(--text-light);
            font-size: 14px;
            background-color: var(--bg-white);
            padding: 8px 16px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        #currentTime {
            font-weight: 600;
            color: var(--text-dark);
            font-family: 'Courier New', monospace;
        }

        .time-separator {
            opacity: 0.5;
            font-weight: 300;
        }
        
        /* ===== Auth Screens ===== */
        .auth-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background: linear-gradient(rgba(26, 115, 232, 0.9), rgba(66, 133, 244, 0.9)), 
                        url('https://wxyzofficial.sirv.com/USC-Election/ssu-view.jpg') center/cover no-repeat;
            background-attachment: fixed;
        }
        
        .auth-card {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            width: 100%;
            max-width: 400px;
            padding: 40px;
            backdrop-filter: blur(10px);
        }
        
        .auth-card h2 {
            color: var(--primary-blue);
            text-align: center;
            margin-bottom: 10px;
            font-size: 24px;
        }
        
        .auth-card p {
            text-align: center;
            color: var(--text-light);
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 16px;
            transition: border 0.3s;
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background-color: var(--primary-blue);
            color: white;
            width: 100%;
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn-google {
            background-color: white;
            color: var(--text-dark);
            border: 1px solid var(--border-color);
            width: 100%;
            margin-top: 10px;
        }
        
        .btn-google:hover {
            background-color: var(--bg-gray);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .auth-divider {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }
        
        .auth-divider::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background-color: var(--border-color);
        }
        
        .auth-divider span {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 0 10px;
            color: var(--text-light);
            font-size: 14px;
        }
        
        .auth-toggle {
            text-align: center;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .auth-toggle a {
            color: var(--primary-blue);
            text-decoration: none;
            font-weight: 500;
        }
        
        .error-message {
            background-color: #ffebee;
            color: var(--accent-red);
            padding: 12px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }
        
        /* ===== Dashboard ===== */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 24px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 20px;
            backdrop-filter: blur(10px);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        
        .stat-icon.admin {
            background-color: var(--primary-blue);
        }
        
        .stat-icon.report {
            background-color: var(--accent-green);
        }
        
        .stat-icon.date {
            background-color: var(--accent-yellow);
        }
        
        .stat-icon.data {
            background-color: var(--accent-red);
        }

        .stat-icon.appointment {
            background-color: #8e44ad;
        }
        
        .stat-info h3 {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-dark);
        }
        
        .stat-info p {
            font-size: 14px;
            color: var(--text-light);
        }
        
        .chart-container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 24px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-header h3 {
            font-size: 18px;
            font-weight: 500;
            color: var(--text-dark);
        }
        
        .year-selector {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 14px;
            color: var(--text-dark);
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        .chart-wrapper {
            position: relative;
            height: 300px;
        }
        
        /* ===== Add Record Form ===== */
        .form-container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 30px;
            max-width: 1000px;
            margin: 0 auto;
            backdrop-filter: blur(10px);
        }
        
        .form-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .form-title h2 {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .form-title .current-date {
            color: var(--text-light);
            font-size: 14px;
            background-color: rgba(248, 249, 250, 0.8);
            padding: 6px 12px;
            border-radius: var(--radius);
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-col {
            flex: 1 1 300px;
        }
        
        .photo-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .photo-preview {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: rgba(248, 249, 250, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            overflow: hidden;
            border: 2px dashed var(--border-color);
        }
        
        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .upload-btn {
            background-color: rgba(248, 249, 250, 0.8);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            color: var(--text-light);
            transition: all 0.3s;
        }
        
        .upload-btn:hover {
            background-color: var(--light-blue);
            border-color: var(--primary-blue);
        }
        
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-actions {
            margin-top: 30px;
            text-align: center;
        }
        
        /* ===== Records Table ===== */
        .table-container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 24px;
            overflow-x: auto;
            backdrop-filter: blur(10px);
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .table-header h2 {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .table-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .entries-select, .search-input {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            font-size: 14px;
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        .search-input {
            min-width: 200px;
        }
        
        .records-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .records-table th {
            background-color: rgba(248, 249, 250, 0.8);
            padding: 16px;
            text-align: left;
            font-weight: 500;
            color: var(--text-dark);
            border-bottom: 1px solid var(--border-color);
        }
        
        .records-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .records-table tr:hover {
            background-color: var(--light-blue);
        }
        
        .records-table tr:nth-child(even) {
            background-color: rgba(248, 249, 250, 0.5);
        }
        
        .records-table tr:nth-child(even):hover {
            background-color: var(--light-blue);
        }
        
        .action-btn {
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            color: white;
            margin-right: 5px;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .btn-view {
            background-color: var(--primary-blue);
        }
        
        .btn-update {
            background-color: var(--accent-yellow);
        }
        
        .btn-delete {
            background-color: var(--accent-red);
        }

        .btn-schedule {
            background-color: #8e44ad;
        }
        
        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        .pagination-info {
            color: var(--text-light);
            font-size: 14px;
        }
        
        .pagination-controls {
            display: flex;
            gap: 10px;
        }
        
        .pagination-btn {
            padding: 8px 16px;
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            cursor: pointer;
            color: var(--text-dark);
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .pagination-btn:hover:not(:disabled) {
            background-color: var(--light-blue);
            transform: translateY(-1px);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* ===== Medical Certificate ===== */
        .certificate-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .certificate-container {
            background-color: var(--bg-white);
            border-radius: var(--radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 40px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .certificate-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-blue);
        }
        
        .university-logo {
            width: 80px;
            height: 80px;
            margin-right: 20px;
        }
        
        .university-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .university-info {
            flex-grow: 1;
            text-align: center;
        }
        
        .university-info h1 {
            color: var(--primary-blue);
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .university-info p {
            color: var(--text-light);
            font-size: 14px;
        }
        
        .certificate-date {
            position: absolute;
            top: 40px;
            right: 40px;
            color: var(--text-light);
            font-size: 14px;
        }
        
        .certificate-title {
            text-align: center;
            margin: 30px 0;
            text-transform: uppercase;
            font-weight: 700;
            font-size: 20px;
            color: var(--text-dark);
        }
        
        .certificate-body {
            margin: 30px 0;
            line-height: 1.8;
        }
        
        .certificate-details {
            margin: 30px 0;
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px dashed var(--border-color);
        }
        
        .detail-label {
            font-weight: 600;
            width: 200px;
            color: var(--text-dark);
        }
        
        .detail-value {
            flex-grow: 1;
            color: var(--text-light);
        }
        
        .certificate-footer {
            margin-top: 40px;
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        .certificate-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn-print {
            background-color: var(--primary-blue);
            color: white;
        }
        
        .btn-close {
            background-color: var(--text-light);
            color: white;
        }
        
        /* ===== Update Record Modal ===== */
        .update-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .update-container {
            background-color: var(--bg-white);
            border-radius: var(--radius);
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        /* ===== Alert Modal ===== */
        .alert-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .alert-container {
            background-color: var(--bg-white);
            border-radius: var(--radius);
            width: 90%;
            max-width: 400px;
            padding: 30px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
        }
        
        .alert-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .alert-icon.success {
            color: var(--accent-green);
        }
        
        .alert-icon.error {
            color: var(--accent-red);
        }
        
        .alert-icon.warning {
            color: var(--accent-yellow);
        }
        
        .alert-icon.info {
            color: var(--primary-blue);
        }
        
        .alert-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-dark);
        }
        
        .alert-message {
            color: var(--text-light);
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .alert-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .btn-confirm {
            background-color: var(--primary-blue);
            color: white;
            min-width: 100px;
        }
        
        .btn-cancel {
            background-color: var(--text-light);
            color: white;
            min-width: 100px;
        }
        
        .btn-ok {
            background-color: var(--primary-blue);
            color: white;
            min-width: 100px;
        }
        
        /* ===== Report Modal ===== */
        .report-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .report-container {
            background-color: var(--bg-white);
            border-radius: var(--radius);
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-blue);
        }
        
        .report-header h2 {
            color: var(--primary-blue);
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .report-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--light-blue);
            border-radius: var(--radius);
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 14px;
            color: var(--text-light);
        }
        
        /* ===== Patient View Modal ===== */
        .patient-view-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .patient-view-container {
            background-color: var(--bg-white);
            border-radius: var(--radius);
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .patient-view-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-blue);
        }
        
        .patient-view-title {
            text-align: center;
            margin: 20px 0;
            font-weight: 700;
            font-size: 22px;
            color: var(--text-dark);
        }
        
        .privacy-notice {
            background-color: var(--light-blue);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 30px;
            font-size: 14px;
            color: var(--text-light);
            border-left: 4px solid var(--primary-blue);
        }
        
        .medical-details-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 30px;
        }
        
        .medical-column {
            background-color: rgba(248, 249, 250, 0.5);
            padding: 20px;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }
        
        .medical-column h4 {
            color: var(--primary-blue);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .medical-column-content {
            min-height: 150px;
            white-space: pre-wrap;
        }
        
        .diagnosis-input {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            resize: vertical;
            margin-bottom: 10px;
        }
        
        /* ===== Medical Certificate Navigation ===== */
        .medical-certificate-view {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        .certificate-options {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .certificate-option {
            flex: 1;
            background-color: var(--light-blue);
            border: 2px solid transparent;
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .certificate-option:hover {
            border-color: var(--primary-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }
        
        .certificate-option.active {
            border-color: var(--primary-blue);
            background-color: rgba(26, 115, 232, 0.1);
        }
        
        .certificate-option i {
            font-size: 36px;
            color: var(--primary-blue);
            margin-bottom: 10px;
        }
        
        .certificate-option h3 {
            font-size: 18px;
            color: var(--text-dark);
            margin-bottom: 10px;
        }
        
        .certificate-option p {
            font-size: 14px;
            color: var(--text-light);
        }
        
        .editable-section {
            background-color: #fff8e1;
            padding: 20px;
            border-radius: var(--radius);
            border: 1px dashed var(--accent-yellow);
            margin: 20px 0;
        }
        
        .non-editable-section {
            background-color: #f5f5f5;
            padding: 20px;
            border-radius: var(--radius);
            margin: 20px 0;
            font-style: italic;
        }

        /* ===== Appointment Scheduling ===== */
        .appointment-form-container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 30px;
            max-width: 1200px;
            margin: 0 auto;
            backdrop-filter: blur(10px);
        }

        .calendar-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--light-blue);
            border-radius: var(--radius);
        }

        .calendar-navigation button {
            padding: 8px 16px;
            background-color: var(--primary-blue);
            color: white;
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .calendar-navigation button:hover {
            background-color: var(--secondary-blue);
            transform: translateY(-1px);
        }

        .calendar-navigation span {
            font-weight: 600;
            font-size: 18px;
            color: var(--text-dark);
        }

        .appointment-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 30px;
        }

        .calendar-header {
            font-weight: 600;
            text-align: center;
            padding: 12px;
            background-color: var(--light-blue);
            border-radius: var(--radius);
            color: var(--text-dark);
            font-size: 14px;
        }

        .calendar-day {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 100px;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .calendar-day:hover {
            background-color: var(--light-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .calendar-day.today {
            background-color: var(--primary-blue);
            color: white;
            border-color: var(--primary-blue);
        }

        .calendar-day.selected {
            background-color: var(--accent-green);
            color: white;
            border-color: var(--accent-green);
        }

        .calendar-day.disabled {
            background-color: var(--bg-gray);
            color: var(--text-light);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .calendar-day.disabled:hover {
            background-color: var(--bg-gray);
            transform: none;
            box-shadow: none;
        }

        .calendar-day .date {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .calendar-day .appointments-count {
            font-size: 12px;
            color: inherit;
            opacity: 0.8;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 2px 6px;
            border-radius: 10px;
            margin-top: 5px;
        }

        .time-slots-container {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--light-blue);
            border-radius: var(--radius);
        }

        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .time-slot {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background-color: rgba(255, 255, 255, 0.8);
        }

        .time-slot:hover {
            background-color: var(--light-blue);
            transform: translateY(-1px);
        }

        .time-slot.selected {
            background-color: var(--accent-green);
            color: white;
            border-color: var(--accent-green);
        }

        .time-slot.booked {
            background-color: var(--accent-red);
            color: white;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .time-slot.booked:hover {
            background-color: var(--accent-red);
            transform: none;
        }

        .appointment-details {
            margin-top: 30px;
            padding: 25px;
            background-color: var(--light-blue);
            border-radius: var(--radius);
            border-left: 4px solid var(--primary-blue);
        }

        .appointment-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-pending {
            background-color: #ff9800;
            color: white;
        }

        .status-confirmed {
            background-color: var(--accent-green);
            color: white;
        }

        .status-cancelled {
            background-color: var(--accent-red);
            color: white;
        }

        .status-completed {
            background-color: var(--primary-blue);
            color: white;
        }

        .appointment-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        /* ===== Responsive Styles ===== */
        @media (max-width: 992px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
            }
            
            .nav-menu {
                display: flex;
                overflow-x: auto;
                padding: 0;
            }
            
            .nav-item {
                white-space: nowrap;
                border-right: none;
                border-bottom: 4px solid transparent;
            }
            
            .nav-item.active {
                border-right: none;
                border-bottom: 4px solid var(--primary-blue);
            }
            
            .medical-details-grid {
                grid-template-columns: 1fr;
            }
            
            .certificate-options {
                flex-direction: column;
            }

            .stats-container {
                grid-template-columns: repeat(2, 1fr);
            }

            .appointment-calendar {
                grid-template-columns: repeat(7, 1fr);
                font-size: 12px;
            }

            .calendar-day {
                min-height: 80px;
                padding: 8px 5px;
            }

            .time-slots {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }
            
            .stats-container {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .table-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .table-controls {
                width: 100%;
                flex-wrap: wrap;
            }
            
            .certificate-container,
            .update-container,
            .report-container,
            .patient-view-container {
                padding: 20px;
            }
            
            .certificate-header {
                flex-direction: column;
                text-align: center;
            }
            
            .certificate-date {
                position: static;
                margin-top: 10px;
                text-align: center;
            }
            
            .detail-row {
                flex-direction: column;
            }
            
            .detail-label {
                width: 100%;
                margin-bottom: 5px;
            }
            
            .patient-view-header {
                flex-direction: column;
                text-align: center;
            }

            .appointment-calendar {
                grid-template-columns: repeat(7, 1fr);
                gap: 4px;
            }

            .calendar-day {
                min-height: 70px;
                padding: 6px 3px;
            }

            .calendar-header {
                padding: 8px 4px;
                font-size: 12px;
            }

            .calendar-navigation {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .calendar-navigation button {
                width: 100%;
            }
        }
        
        .hidden {
            display: none !important;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-light);
        }
        
        /* ===== PRINT STYLES ===== */
        @media print {
            body * {
                visibility: hidden;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                background: white !important;
                color: black !important;
                max-height: none !important;
                overflow: visible !important;
            }
            
            .certificate-modal,
            .certificate-modal * {
                visibility: visible;
            }
            
            .certificate-modal {
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                height: auto !important;
                background: white !important;
                z-index: 999999 !important;
                overflow: visible !important;
                display: block !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .certificate-container {
                width: 100% !important;
                max-width: 100% !important;
                max-height: none !important;
                height: auto !important;
                margin: 0 !important;
                padding: 20mm !important;
                box-shadow: none !important;
                border: none !important;
                border-radius: 0 !important;
                overflow: visible !important;
                page-break-inside: avoid !important;
            }
            
            .certificate-actions,
            .certificate-modal::before,
            .certificate-modal::after {
                display: none !important;
            }
            
            .patient-view-modal,
            .patient-view-modal * {
                visibility: visible;
            }
            
            .patient-view-modal {
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                height: auto !important;
                background: white !important;
                z-index: 999999 !important;
                overflow: visible !important;
                display: block !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .patient-view-container {
                width: 100% !important;
                max-width: 100% !important;
                max-height: none !important;
                height: auto !important;
                margin: 0 !important;
                padding: 20mm !important;
                box-shadow: none !important;
                border: none !important;
                border-radius: 0 !important;
                overflow: visible !important;
                page-break-inside: avoid !important;
            }
            
            .patient-view-actions,
            .patient-view-modal::before,
            .patient-view-modal::after {
                display: none !important;
            }
            
            .report-modal,
            .report-modal * {
                visibility: visible;
            }
            
            .report-modal {
                position: absolute !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                height: auto !important;
                background: white !important;
                z-index: 999999 !important;
                overflow: visible !important;
                display: block !important;
                margin: 0 !important;
                padding: 0 !important;
            }
            
            .report-container {
                width: 100% !important;
                max-width: 100% !important;
                max-height: none !important;
                height: auto !important;
                margin: 0 !important;
                padding: 20mm !important;
                box-shadow: none !important;
                border: none !important;
                border-radius: 0 !important;
                overflow: visible !important;
            }
            
            .report-actions,
            .report-modal::before,
            .report-modal::after {
                display: none !important;
            }
            
            .records-table {
                width: 100% !important;
                border-collapse: collapse !important;
                page-break-inside: auto !important;
            }
            
            .records-table tr {
                page-break-inside: avoid !important;
                page-break-after: auto !important;
            }
            
            .records-table th,
            .records-table td {
                border: 1px solid #000 !important;
                padding: 8px !important;
                text-align: left !important;
            }
            
            .certificate-body,
            .certificate-details,
            .medical-details-grid,
            .report-summary,
            .print-report-table {
                display: block !important;
                visibility: visible !important;
                height: auto !important;
                max-height: none !important;
                overflow: visible !important;
            }
            
            .certificate-container,
            .patient-view-container,
            .report-container {
                page-break-after: always !important;
            }
            
            .btn,
            .action-btn,
            .form-control,
            textarea,
            input,
            select,
            .upload-btn,
            .photo-upload,
            .nav-menu,
            .sidebar,
            .header,
            .auth-container,
            .alert-modal,
            .update-modal,
            .close-btn {
                display: none !important;
            }
            
            body {
                font-size: 12pt !important;
                line-height: 1.5 !important;
            }
            
            h1, h2, h3, h4 {
                color: #000 !important;
                page-break-after: avoid !important;
            }
            
            img {
                max-width: 100% !important;
                height: auto !important;
            }
            
            .stat-card,
            .chart-container,
            .form-container,
            .table-container,
            .medical-certificate-view,
            .privacy-notice,
            .medical-column,
            .editable-section,
            .non-editable-section {
                background: white !important;
                border: 1px solid #000 !important;
                box-shadow: none !important;
            }
            
            .medical-details-grid {
                display: grid !important;
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 10px !important;
            }
            
            .report-summary {
                display: grid !important;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important;
                gap: 10px !important;
            }
            
            @page {
                size: A4 portrait;
                margin: 20mm;
            }
        }
    </style>
</head>
<body>
    <!-- Authentication Screen -->
    <div id="authScreen" class="auth-container">
        <div class="auth-card">
            <h2 id="authTitle">Login to DHRM System</h2>
            <p id="authSubtitle">Digital Health Records Management System</p>
            
            <div id="authError" class="error-message"></div>
            
            <form id="authForm">
                <div id="nameGroup" class="form-group hidden">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" class="form-control" placeholder="Enter your full name">
                </div>
                
                <div class="form-group">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" class="form-control" placeholder="Enter your email">
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" class="form-control" placeholder="Enter your password">
                </div>
                
                <div id="confirmPasswordGroup" class="form-group hidden">
                    <label for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm your password">
                </div>
                
                <button type="submit" id="authSubmit" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                
                <div class="auth-divider">
                    <span>OR</span>
                </div>
                
                <button type="button" id="googleSignIn" class="btn btn-google">
                    <i class="fab fa-google"></i> Sign in with Google
                </button>
            </form>
            
            <div class="auth-toggle">
                <span id="authToggleText">Don't have an account?</span>
                <a href="#" id="authToggleLink">Sign up here</a>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div id="alertModal" class="alert-modal hidden">
        <div class="alert-container">
            <div class="alert-icon" id="alertIcon">
                <i class="fas fa-info-circle"></i>
            </div>
            <div class="alert-title" id="alertTitle">Alert Title</div>
            <div class="alert-message" id="alertMessage">Alert message goes here</div>
            <div class="alert-actions" id="alertActions">
                <!-- Buttons will be added dynamically -->
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="appContainer" class="container hidden">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="logo-container">
                <div class="logo">
                    <img src="https://wxyzofficial.sirv.com/USC-Election/ssu.jpg" alt="SSU Logo">
                </div>
                <div class="logo-text">
                    <h2>SSU DHRM</h2>
                    <p>Digital Health Records</p>
                </div>
            </div>
            
            <div class="nav-menu">
                <a href="#" class="nav-item active" data-view="dashboard">
                    <i class="fas fa-tachometer-alt nav-icon"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-view="addRecord">
                    <i class="fas fa-plus-circle nav-icon"></i>
                    <span>Add Record</span>
                </a>
                <a href="#" class="nav-item" data-view="medicalRecords">
                    <i class="fas fa-file-medical nav-icon"></i>
                    <span>Medical Records</span>
                </a>
                <a href="#" class="nav-item" data-view="dentalRecords">
                    <i class="fas fa-tooth nav-icon"></i>
                    <span>Dental Records</span>
                </a>
                <a href="#" class="nav-item" data-view="appointmentSchedule">
                    <i class="fas fa-calendar-check nav-icon"></i>
                    <span>Appointment</span>
                </a>
                <a href="#" class="nav-item" data-view="medicalCertificate">
                    <i class="fas fa-certificate nav-icon"></i>
                    <span>Medical Certificate</span>
                </a>
                <a href="#" class="nav-item" data-view="createReport">
                    <i class="fas fa-chart-bar nav-icon"></i>
                    <span>Create Report</span>
                </a>
            </div>
            
            <div class="user-profile">
                <div class="user-avatar" id="userAvatar">
                    JD
                </div>
                <div class="user-info">
                    <h4 id="userName">John Doe</h4>
                    <p id="userEmail">admin@example.com</p>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1 id="pageTitle">Dashboard</h1>
                <div class="date-display">
                    <span id="currentDate"></span>
                    <span class="time-separator"></span>
                    <span id="currentTime"></span>
                </div>
            </div>
            
            <!-- Dashboard View -->
            <div id="dashboardView" class="view-content">
                <div class="stats-container">
                    <div class="stat-card">
                        <div class="stat-icon admin">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="adminCount">0</h3>
                            <p>Total Admins</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon report">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="reportCount">0</h3>
                            <p>Total Reports</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon date">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="lastRecordDate">N/A</h3>
                            <p>Last Recorded Data</p>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon appointment">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3 id="appointmentCount">0</h3>
                            <p>Today's Appointments</p>
                        </div>
                    </div>
                </div>
                
                <div class="chart-container">
                    <div class="chart-header">
                        <h3>DATA GRAPH</h3>
                        <select class="year-selector" id="yearSelector">
                            <option value="2026">2026</option>
                            <option value="2025">2025</option>
                            <option value="2024">2024</option>
                            <option value="2023">2023</option>
                            <option value="2022">2022</option>
                            <option value="2021">2021</option>
                            <option value="2020">2020</option>
                        </select>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="dataChart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Add Record View -->
            <div id="addRecordView" class="view-content hidden">
                <div class="form-container">
                    <div class="form-title">
                        <h2>Fill out the asked information</h2>
                        <div class="current-date" id="formDate">October 16, 2023</div>
                    </div>
                    
                    <form id="recordForm">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="photo-upload">
                                    <div class="photo-preview" id="photoPreview">
                                        <i class="fas fa-user fa-3x" style="color: #ccc;"></i>
                                    </div>
                                    <input type="file" id="photoUpload" accept="image/*" class="hidden">
                                    <label for="photoUpload" class="upload-btn">
                                        <i class="fas fa-upload"></i> Upload Display Picture
                                    </label>
                                </div>
                            </div>
                            
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="patientName">Full Name *</label>
                                    <input type="text" id="patientName" class="form-control" placeholder="Enter full name" required>
                                </div>
                                
                                <div class="form-group">
                                    <label for="patientAge">Age *</label>
                                    <input type="number" id="patientAge" class="form-control" placeholder="Enter age" required min="1" max="120">
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="contactNumber">Contact Number *</label>
                                    <input type="tel" id="contactNumber" class="form-control" placeholder="Enter contact number" required>
                                </div>
                            </div>
                            
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="homeAddress">Home Address *</label>
                                    <input type="text" id="homeAddress" class="form-control" placeholder="Enter home address" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="recordDate">Date</label>
                                    <input type="text" id="recordDate" class="form-control" value="October 16, 2023" readonly>
                                </div>
                            </div>
                            
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="birthday">Birthday *</label>
                                    <input type="date" id="birthday" class="form-control" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="sex">Sex *</label>
                                    <select id="sex" class="form-control" required>
                                        <option value="">Select Sex</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="patientType">Patient Type *</label>
                                    <select id="patientType" class="form-control" required>
                                        <option value="">Select Patient Type</option>
                                        <option value="Student">Student</option>
                                        <option value="Faculty">Faculty</option>
                                        <option value="Staff">Staff</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="department">Department *</label>
                                    <select id="department" class="form-control" required>
                                        <option value="">Select Department</option>
                                        <option value="College of Arts and Sciences">College of Arts and Sciences</option>
                                        <option value="College of Education">College of Education</option>
                                        <option value="College of Engineering">College of Engineering</option>
                                        <option value="College of Nursing">College of Nursing</option>
                                        <option value="College of Industrial Technology">College of Industrial Technology</option>
                                        <option value="Graduate School">Graduate School</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="course">Course *</label>
                                    <input type="text" id="course" class="form-control" placeholder="Enter course (e.g., BS in Computer Science)" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="categoryType">Category Type *</label>
                                    <select id="categoryType" class="form-control" required>
                                        <option value="">Select Category Type</option>
                                        <option value="Medical">Medical</option>
                                        <option value="Dental">Dental</option>
                                        <option value="Consultation">Consultation</option>
                                        <option value="Emergency">Emergency</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-col">
                                <!-- Empty column for alignment -->
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="diagnoses">Diagnoses *</label>
                                    <textarea id="diagnoses" class="form-control" placeholder="Enter diagnoses" required></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="medicine">Medicine Prescribed *</label>
                                    <textarea id="medicine" class="form-control" placeholder="Enter prescribed medicine" required></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="remarks">Remarks</label>
                                    <textarea id="remarks" class="form-control" placeholder="Enter additional remarks"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" style="padding: 15px 40px; font-size: 18px;">
                                <i class="fas fa-save"></i> Submit Record
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Medical Records View -->
            <div id="medicalRecordsView" class="view-content hidden">
                <div class="table-container">
                    <div class="table-header">
                        <h2>Medical Records</h2>
                        <div class="table-controls">
                            <div>
                                <label for="entriesSelect">Show</label>
                                <select id="entriesSelect" class="entries-select">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                <span>entries</span>
                            </div>
                            <div>
                                <input type="text" id="searchMedical" class="search-input" placeholder="Search records...">
                            </div>
                        </div>
                    </div>
                    
                    <div class="loading" id="medicalLoading">Loading medical records...</div>
                    
                    <table class="records-table" id="medicalTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Sex</th>
                                <th>Date</th>
                                <th>Address</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="medicalTableBody">
                            <!-- Records will be populated here -->
                        </tbody>
                    </table>
                    
                    <div class="pagination" id="medicalPagination">
                        <div class="pagination-info" id="medicalPaginationInfo">Showing 0 to 0 of 0 entries</div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" id="medicalPrevBtn" disabled>Previous</button>
                            <button class="pagination-btn" id="medicalNextBtn" disabled>Next</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dental Records View -->
            <div id="dentalRecordsView" class="view-content hidden">
                <div class="table-container">
                    <div class="table-header">
                        <h2>Dental Records</h2>
                        <div class="table-controls">
                            <div>
                                <label for="dentalEntriesSelect">Show</label>
                                <select id="dentalEntriesSelect" class="entries-select">
                                    <option value="10">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                                <span>entries</span>
                            </div>
                            <div>
                                <input type="text" id="searchDental" class="search-input" placeholder="Search records...">
                            </div>
                        </div>
                    </div>
                    
                    <div class="loading" id="dentalLoading">Loading dental records...</div>
                    
                    <table class="records-table" id="dentalTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Sex</th>
                                <th>Date</th>
                                <th>Address</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="dentalTableBody">
                            <!-- Records will be populated here -->
                        </tbody>
                    </table>
                    
                    <div class="pagination" id="dentalPagination">
                        <div class="pagination-info" id="dentalPaginationInfo">Showing 0 to 0 of 0 entries</div>
                        <div class="pagination-controls">
                            <button class="pagination-btn" id="dentalPrevBtn" disabled>Previous</button>
                            <button class="pagination-btn" id="dentalNextBtn" disabled>Next</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Appointment Scheduling View -->
            <div id="appointmentScheduleView" class="view-content hidden">
                <div class="appointment-form-container">
                    <div class="form-title">
                        <h2>Appointment Scheduling</h2>
                        <button class="btn btn-primary" id="newAppointmentBtn">
                            <i class="fas fa-plus"></i> New Appointment
                        </button>
                    </div>

                    <div class="calendar-navigation">
                        <button id="prevMonthBtn">
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <span id="currentMonthYear">January 2024</span>
                        <button id="nextMonthBtn">
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>

                    <div class="appointment-calendar" id="appointmentCalendar">
                        <!-- Calendar will be generated here -->
                    </div>

                    <div class="appointment-details" id="appointmentDetails">
                        <h3>Appointment Details</h3>
                        <p>Select a date to view appointments</p>
                    </div>

                    <div class="table-container" style="margin-top: 30px;">
                        <div class="table-header">
                            <h2>Scheduled Appointments</h2>
                            <div class="table-controls">
                                <input type="text" id="searchAppointments" class="search-input" placeholder="Search appointments...">
                            </div>
                        </div>
                        
                        <table class="records-table" id="appointmentsTable">
                            <thead>
                                <tr>
                                    <th>Patient Name</th>
                                    <th>Date & Time</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="appointmentsTableBody">
                                <!-- Appointments will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Medical Certificate View -->
            <div id="medicalCertificateView" class="view-content hidden">
                <div class="medical-certificate-view">
                    <div class="form-title">
                        <h2>Medical Certificate</h2>
                        <div class="current-date" id="certificateFormDate">October 16, 2023</div>
                    </div>
                    
                    <div class="certificate-options">
                        <div class="certificate-option active" id="standardCertificateOption">
                            <i class="fas fa-file-medical"></i>
                            <h3>Standard Certificate</h3>
                            <p>View and print medical certificate for patients</p>
                        </div>
                        <div class="certificate-option" id="individualReportOption">
                            <i class="fas fa-user-injured"></i>
                            <h3>Individual Patient Report</h3>
                            <p>Detailed individual patient medical record</p>
                        </div>
                    </div>
                    
                    <div id="standardCertificateSection">
                        <div class="table-container">
                            <div class="table-header">
                                <h2>Select Patient for Certificate</h2>
                                <div class="table-controls">
                                    <div>
                                        <input type="text" id="searchCertificate" class="search-input" placeholder="Search patients...">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="loading" id="certificateLoading">Loading patient records...</div>
                            
                            <table class="records-table" id="certificateTable">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Sex</th>
                                        <th>Patient Type</th>
                                        <th>Department</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="certificateTableBody">
                                    <!-- Patient records will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div id="individualReportSection" class="hidden">
                        <div class="table-container">
                            <div class="table-header">
                                <h2>Select Patient for Individual Report</h2>
                                <div class="table-controls">
                                    <div>
                                        <input type="text" id="searchIndividualReport" class="search-input" placeholder="Search patients...">
                                    </div>
                                </div>
                            </div>
                            
                            <table class="records-table" id="individualReportTable">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Sex</th>
                                        <th>Age</th>
                                        <th>Department</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="individualReportTableBody">
                                    <!-- Patient records will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Create Report View -->
            <div id="createReportView" class="view-content hidden">
                <div class="table-container">
                    <div class="table-header">
                        <h2>Create Report</h2>
                        <button class="btn btn-primary" id="generateReportBtn">
                            <i class="fas fa-file-export"></i> Generate Report
                        </button>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <input type="text" id="reportSearch" class="search-input" style="width: 100%;" placeholder="Search records for report...">
                    </div>
                    
                    <div class="loading" id="reportLoading">Loading records for report...</div>
                    
                    <table class="records-table" id="reportTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Sex</th>
                                <th>Category</th>
                                <th>Age</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody id="reportTableBody">
                            <!-- Report records will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- New Appointment Modal -->
    <div id="newAppointmentModal" class="update-modal hidden">
        <div class="update-container">
            <div class="form-title">
                <h2>Schedule New Appointment</h2>
                <button class="btn btn-close" id="closeNewAppointmentBtn">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
            
            <form id="newAppointmentForm">
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="appointmentPatientName">Patient Name *</label>
                            <input type="text" id="appointmentPatientName" class="form-control" placeholder="Enter patient name" required>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="appointmentPatientContact">Contact Number *</label>
                            <input type="tel" id="appointmentPatientContact" class="form-control" placeholder="Enter contact number" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="appointmentDate">Appointment Date *</label>
                            <input type="date" id="appointmentDate" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="appointmentTime">Appointment Time *</label>
                            <select id="appointmentTime" class="form-control" required>
                                <option value="">Select Time</option>
                                <option value="08:00">08:00 AM</option>
                                <option value="09:00">09:00 AM</option>
                                <option value="10:00">10:00 AM</option>
                                <option value="11:00">11:00 AM</option>
                                <option value="13:00">01:00 PM</option>
                                <option value="14:00">02:00 PM</option>
                                <option value="15:00">03:00 PM</option>
                                <option value="16:00">04:00 PM</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="appointmentType">Appointment Type *</label>
                            <select id="appointmentType" class="form-control" required>
                                <option value="">Select Type</option>
                                <option value="Medical Consultation">Medical Consultation</option>
                                <option value="Dental Checkup">Dental Checkup</option>
                                <option value="Follow-up">Follow-up</option>
                                <option value="Emergency">Emergency</option>
                                <option value="Vaccination">Vaccination</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="appointmentDepartment">Department *</label>
                            <select id="appointmentDepartment" class="form-control" required>
                                <option value="">Select Department</option>
                                <option value="College of Arts and Sciences">College of Arts and Sciences</option>
                                <option value="College of Education">College of Education</option>
                                <option value="College of Engineering">College of Engineering</option>
                                <option value="College of Nursing">College of Nursing</option>
                                <option value="College of Industrial Technology">College of Industrial Technology</option>
                                <option value="Graduate School">Graduate School</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="appointmentReason">Reason for Appointment *</label>
                            <textarea id="appointmentReason" class="form-control" rows="3" placeholder="Enter reason for appointment" required></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="appointmentNotes">Additional Notes</label>
                            <textarea id="appointmentNotes" class="form-control" rows="2" placeholder="Enter additional notes"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" style="padding: 15px 40px; font-size: 18px;">
                        <i class="fas fa-calendar-plus"></i> Schedule Appointment
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Update Appointment Modal -->
    <div id="updateAppointmentModal" class="update-modal hidden">
        <div class="update-container">
            <div class="form-title">
                <h2>Update Appointment</h2>
                <button class="btn btn-close" id="closeUpdateAppointmentBtn">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
            
            <form id="updateAppointmentForm">
                <input type="hidden" id="updateAppointmentId">
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateAppointmentPatientName">Patient Name *</label>
                            <input type="text" id="updateAppointmentPatientName" class="form-control" placeholder="Enter patient name" required>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateAppointmentPatientContact">Contact Number *</label>
                            <input type="tel" id="updateAppointmentPatientContact" class="form-control" placeholder="Enter contact number" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateAppointmentDate">Appointment Date *</label>
                            <input type="date" id="updateAppointmentDate" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateAppointmentTime">Appointment Time *</label>
                            <select id="updateAppointmentTime" class="form-control" required>
                                <option value="">Select Time</option>
                                <option value="08:00">08:00 AM</option>
                                <option value="09:00">09:00 AM</option>
                                <option value="10:00">10:00 AM</option>
                                <option value="11:00">11:00 AM</option>
                                <option value="13:00">01:00 PM</option>
                                <option value="14:00">02:00 PM</option>
                                <option value="15:00">03:00 PM</option>
                                <option value="16:00">04:00 PM</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateAppointmentType">Appointment Type *</label>
                            <select id="updateAppointmentType" class="form-control" required>
                                <option value="">Select Type</option>
                                <option value="Medical Consultation">Medical Consultation</option>
                                <option value="Dental Checkup">Dental Checkup</option>
                                <option value="Follow-up">Follow-up</option>
                                <option value="Emergency">Emergency</option>
                                <option value="Vaccination">Vaccination</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateAppointmentDepartment">Department *</label>
                            <select id="updateAppointmentDepartment" class="form-control" required>
                                <option value="">Select Department</option>
                                <option value="College of Arts and Sciences">College of Arts and Sciences</option>
                                <option value="College of Education">College of Education</option>
                                <option value="College of Engineering">College of Engineering</option>
                                <option value="College of Nursing">College of Nursing</option>
                                <option value="College of Industrial Technology">College of Industrial Technology</option>
                                <option value="Graduate School">Graduate School</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateAppointmentReason">Reason for Appointment *</label>
                            <textarea id="updateAppointmentReason" class="form-control" rows="3" placeholder="Enter reason for appointment" required></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateAppointmentNotes">Additional Notes</label>
                            <textarea id="updateAppointmentNotes" class="form-control" rows="2" placeholder="Enter additional notes"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateAppointmentStatus">Status *</label>
                            <select id="updateAppointmentStatus" class="form-control" required>
                                <option value="">Select Status</option>
                                <option value="Pending">Pending</option>
                                <option value="Confirmed">Confirmed</option>
                                <option value="Cancelled">Cancelled</option>
                                <option value="Completed">Completed</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" style="padding: 15px 40px; font-size: 18px;">
                        <i class="fas fa-save"></i> Update Appointment
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Patient View Modal -->
    <div id="patientViewModal" class="patient-view-modal hidden">
        <div class="patient-view-container">
            <div class="patient-view-header">
                <div class="university-logo">
                    <img src="https://wxyzofficial.sirv.com/USC-Election/ssu.jpg" alt="Samar State University Logo">
                </div>
                <div class="university-info">
                    <h1>SAMAR STATE UNIVERSITY</h1>
                    <p>Catbalogan City, Samar</p>
                    <p>SSU CARE & WELLNESS SERVICES-UNIVERSITY CLINIC</p>
                </div>
            </div>
            
            <div class="patient-view-title">INDIVIDUAL PATIENT RECORD</div>
            
            <div class="privacy-notice">
                <p><strong>Privacy Notice:</strong> This document contains personal and medical information. By accessing this record, you agree to comply with data privacy laws and regulations. All information is confidential and shall be used only for medical purposes. Proper storage, retention, and disposal procedures shall be followed as per government regulations.</p>
            </div>
            
            <div class="certificate-details">
                <div class="detail-row">
                    <div class="detail-label">Patient Name:</div>
                    <div class="detail-value" id="viewPatientName">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Age:</div>
                    <div class="detail-value" id="viewPatientAge">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Sex:</div>
                    <div class="detail-value" id="viewPatientSex">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Civil Status:</div>
                    <div class="detail-value" id="viewCivilStatus">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Birthday:</div>
                    <div class="detail-value" id="viewPatientBirthday">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Contact Number:</div>
                    <div class="detail-value" id="viewPatientContact">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Department:</div>
                    <div class="detail-value" id="viewPatientDepartment">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Course:</div>
                    <div class="detail-value" id="viewPatientCourse">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Address:</div>
                    <div class="detail-value" id="viewPatientAddress">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Guardian:</div>
                    <div class="detail-value" id="viewPatientGuardian">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Emergency Contact:</div>
                    <div class="detail-value" id="viewEmergencyContact">-</div>
                </div>
            </div>
            
            <div class="medical-details-grid">
                <div class="medical-column">
                    <h4>Complaint</h4>
                    <div class="medical-column-content" id="viewComplaint">No complaint recorded</div>
                </div>
                <div class="medical-column">
                    <h4>Diagnostic / Diagnoses</h4>
                    <div class="medical-column-content" id="viewDiagnoses">No diagnosis recorded</div>
                </div>
                <div class="medical-column">
                    <h4>Treatment & Remarks</h4>
                    <div class="medical-column-content" id="viewTreatment">No treatment recorded</div>
                </div>
            </div>
            
            <div class="certificate-actions patient-view-actions" style="margin-top: 30px;">
                <button class="btn btn-close" id="closePatientViewBtn">
                    <i class="fas fa-times"></i> Close
                </button>
                <button class="btn btn-print" id="printPatientRecordBtn">
                    <i class="fas fa-print"></i> Print Content
                </button>
            </div>
        </div>
    </div>

    <!-- Medical Certificate Modal -->
    <div id="certificateModal" class="certificate-modal hidden">
        <div class="certificate-container">
            <div class="certificate-header">
                <div class="university-logo">
                    <img src="https://wxyzofficial.sirv.com/USC-Election/ssu.jpg" alt="Samar State University Logo">
                </div>
                <div class="university-info">
                    <h1>SAMAR STATE UNIVERSITY</h1>
                    <p>Catbalogan City, Samar</p>
                    <p>SSU CARE & WELLNESS SERVICES-UNIVERSITY CLINIC</p>
                </div>
            </div>
            
            <div class="certificate-title" id="certificateTitle">MEDICAL CERTIFICATE</div>
            
            <div class="certificate-body">
                <div class="non-editable-section">
                    <p>To whom it may concern:</p>
                    <p>This is to certify that <strong id="certPatientName">[Patient Name]</strong>, <strong id="certPatientAge">[Patient Age]</strong> years old, a <strong id="certPatientCourse">[Patient Course]</strong> was examined at the SSU Care & Wellness Services-University Clinic on <strong id="certExamDate">[Examination Date]</strong>.</p>
                </div>
                
                <div class="editable-section">
                    <div class="form-group">
                        <label for="editableDiagnoses"><strong>Diagnosis:</strong></label>
                        <textarea id="editableDiagnoses" class="form-control" rows="3" placeholder="Enter diagnosis..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="editableMedicine"><strong>Medicine:</strong></label>
                        <textarea id="editableMedicine" class="form-control" rows="3" placeholder="Enter prescribed medicine..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="editableRemarks"><strong>Remarks:</strong></label>
                        <textarea id="editableRemarks" class="form-control" rows="3" placeholder="Enter remarks..."></textarea>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <p>This certificate is issued upon the request of the patient for whatever legal purpose it may serve.</p>
                </div>
            </div>
            
            <div class="certificate-details">
                <div class="detail-row">
                    <div class="detail-label">Patient Name:</div>
                    <div class="detail-value" id="detailName">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Age:</div>
                    <div class="detail-value" id="detailAge">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Sex:</div>
                    <div class="detail-value" id="detailSex">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Birthday:</div>
                    <div class="detail-value" id="detailBirthday">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Contact Number:</div>
                    <div class="detail-value" id="detailContact">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Address:</div>
                    <div class="detail-value" id="detailAddress">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Department:</div>
                    <div class="detail-value" id="detailDepartment">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Course:</div>
                    <div class="detail-value" id="detailCourse">-</div>
                </div>
                <div class="detail-row">
                    <div class="detail-label">Category:</div>
                    <div class="detail-value" id="detailCategory">-</div>
                </div>
            </div>
            
            <div class="certificate-footer">
                <div style="text-align: center; margin-top: 50px;">
                    <div style="border-top: 1px solid #000; width: 200px; margin: 0 auto; padding-top: 10px;">
                        <strong>Dr. Maria Santos</strong><br>
                        <em>University Physician</em><br>
                        <em>Samar State University</em>
                    </div>
                </div>
                
                <div class="certificate-actions">
                    <button class="btn btn-print" id="printCertificateBtn">
                        <i class="fas fa-print"></i> Print Certificate
                    </button>
                    <button class="btn btn-close" id="closeCertificateBtn">
                        <i class="fas fa-times"></i> Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Update Record Modal -->
    <div id="updateModal" class="update-modal hidden">
        <div class="update-container">
            <div class="form-title">
                <h2>Update Record</h2>
                <button class="btn btn-close" id="closeUpdateBtn">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
            
            <form id="updateForm">
                <input type="hidden" id="updateRecordId">
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="photo-upload">
                            <div class="photo-preview" id="updatePhotoPreview">
                                <i class="fas fa-user fa-3x" style="color: #ccc;"></i>
                            </div>
                            <input type="file" id="updatePhotoUpload" accept="image/*" class="hidden">
                            <label for="updatePhotoUpload" class="upload-btn">
                                <i class="fas fa-upload"></i> Update Picture
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updatePatientName">Full Name *</label>
                            <input type="text" id="updatePatientName" class="form-control" placeholder="Enter full name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="updatePatientAge">Age *</label>
                            <input type="number" id="updatePatientAge" class="form-control" placeholder="Enter age" required min="1" max="120">
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateContactNumber">Contact Number *</label>
                            <input type="tel" id="updateContactNumber" class="form-control" placeholder="Enter contact number" required>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateHomeAddress">Home Address *</label>
                            <input type="text" id="updateHomeAddress" class="form-control" placeholder="Enter home address" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateRecordDate">Date</label>
                            <input type="text" id="updateRecordDate" class="form-control" readonly>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateBirthday">Birthday *</label>
                            <input type="date" id="updateBirthday" class="form-control" required>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateSex">Sex *</label>
                            <select id="updateSex" class="form-control" required>
                                <option value="">Select Sex</option>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updatePatientType">Patient Type *</label>
                            <select id="updatePatientType" class="form-control" required>
                                <option value="">Select Patient Type</option>
                                <option value="Student">Student</option>
                                <option value="Faculty">Faculty</option>
                                <option value="Staff">Staff</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateDepartment">Department *</label>
                            <select id="updateDepartment" class="form-control" required>
                                <option value="">Select Department</option>
                                <option value="College of Arts and Sciences">College of Arts and Sciences</option>
                                <option value="College of Education">College of Education</option>
                                <option value="College of Engineering">College of Engineering</option>
                                <option value="College of Nursing">College of Nursing</option>
                                <option value="College of Industrial Technology">College of Industrial Technology</option>
                                <option value="Graduate School">Graduate School</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateCourse">Course *</label>
                            <input type="text" id="updateCourse" class="form-control" placeholder="Enter course">
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateCategoryType">Category Type *</label>
                            <select id="updateCategoryType" class="form-control" required>
                                <option value="">Select Category Type</option>
                                <option value="Medical">Medical</option>
                                <option value="Dental">Dental</option>
                                <option value="Consultation">Consultation</option>
                                <option value="Emergency">Emergency</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-col">
                        <!-- Empty column for alignment -->
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateDiagnoses">Diagnoses *</label>
                            <textarea id="updateDiagnoses" class="form-control" placeholder="Enter diagnoses" required></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateMedicine">Medicine Prescribed *</label>
                            <textarea id="updateMedicine" class="form-control" placeholder="Enter prescribed medicine" required></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label for="updateRemarks">Remarks</label>
                            <textarea id="updateRemarks" class="form-control" placeholder="Enter additional remarks"></textarea>
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" style="padding: 15px 40px; font-size: 18px;">
                        <i class="fas fa-save"></i> Update Record
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Report Modal -->
    <div id="reportModal" class="report-modal hidden">
        <div class="report-container">
            <div class="report-header">
                <div class="university-logo">
                    <img src="https://wxyzofficial.sirv.com/USC-Election/ssu.jpg" alt="Samar State University Logo" style="width: 60px; height: 60px;">
                </div>
                <h1>SAMAR STATE UNIVERSITY</h1>
                <h2 id="reportTitle">Health Records Report</h2>
                <p id="reportPeriod">Generated on: <span id="reportGenerationDate"></span></p>
            </div>
            
            <div class="report-summary" id="reportSummary">
                <!-- Summary will be populated here -->
            </div>
            
            <div class="table-container" style="background: none; box-shadow: none; padding: 0;">
                <table class="records-table" id="printReportTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Sex</th>
                            <th>Category</th>
                            <th>Age</th>
                            <th>Department</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody id="printReportTableBody">
                        <!-- Report records will be populated here -->
                    </tbody>
                </table>
            </div>
            
            <div class="report-actions" style="margin-top: 30px; text-align: center;">
                <button class="btn btn-print" id="printReportBtn">
                    <i class="fas fa-print"></i> Print Report
                </button>
                <button class="btn btn-close" id="closeReportBtn">
                    <i class="fas fa-times"></i> Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== Firebase Configuration =====
        const firebaseConfig = {
            apiKey: "AIzaSyCFKyfCKY3uphwN6gU9wUWQw682DO15mro",
            authDomain: "dhrm-9f786.firebaseapp.com",
            projectId: "dhrm-9f786",
            storageBucket: "dhrm-9f786.firebasestorage.app",
            messagingSenderId: "996122307429",
            appId: "1:996122307429:web:c3a500c9e716d7f6aecf8c",
            measurementId: "G-P9ZJVCWKFJ"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // ===== Global Variables =====
        let currentUser = null;
        let currentView = 'dashboard';
        let medicalRecords = [];
        let dentalRecords = [];
        let allRecords = [];
        let appointments = [];
        let medicalCurrentPage = 1;
        let medicalEntriesPerPage = 10;
        let dentalCurrentPage = 1;
        let dentalEntriesPerPage = 10;
        let dataChart = null;
        let currentCertificateData = null;
        let photoBase64 = null;
        let updatePhotoBase64 = null;
        let currentRecordId = null;
        let currentPatientViewData = null;
        let certificateType = 'standard';
        let currentCalendarMonth = new Date().getMonth();
        let currentCalendarYear = new Date().getFullYear();
        let selectedAppointmentDate = null;
        let currentAppointmentId = null;
        
        // ===== DOM Elements =====
        const authScreen = document.getElementById('authScreen');
        const appContainer = document.getElementById('appContainer');
        const authForm = document.getElementById('authForm');
        const authTitle = document.getElementById('authTitle');
        const authSubtitle = document.getElementById('authSubtitle');
        const authError = document.getElementById('authError');
        const nameGroup = document.getElementById('nameGroup');
        const confirmPasswordGroup = document.getElementById('confirmPasswordGroup');
        const authSubmit = document.getElementById('authSubmit');
        const googleSignIn = document.getElementById('googleSignIn');
        const authToggleText = document.getElementById('authToggleText');
        const authToggleLink = document.getElementById('authToggleLink');
        const logoutBtn = document.getElementById('logoutBtn');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userEmail = document.getElementById('userEmail');
        const currentDate = document.getElementById('currentDate');
        const currentTime = document.getElementById('currentTime');
        const formDate = document.getElementById('formDate');
        
        // Dashboard elements
        const adminCount = document.getElementById('adminCount');
        const reportCount = document.getElementById('reportCount');
        const lastRecordDate = document.getElementById('lastRecordDate');
        const totalRecords = document.getElementById('totalRecords');
        const appointmentCount = document.getElementById('appointmentCount');
        const yearSelector = document.getElementById('yearSelector');
        
        // Appointment elements
        const newAppointmentBtn = document.getElementById('newAppointmentBtn');
        const prevMonthBtn = document.getElementById('prevMonthBtn');
        const nextMonthBtn = document.getElementById('nextMonthBtn');
        const currentMonthYear = document.getElementById('currentMonthYear');
        const appointmentCalendar = document.getElementById('appointmentCalendar');
        const appointmentDetails = document.getElementById('appointmentDetails');
        const appointmentsTableBody = document.getElementById('appointmentsTableBody');
        const searchAppointments = document.getElementById('searchAppointments');
        const newAppointmentModal = document.getElementById('newAppointmentModal');
        const newAppointmentForm = document.getElementById('newAppointmentForm');
        const closeNewAppointmentBtn = document.getElementById('closeNewAppointmentBtn');
        const updateAppointmentModal = document.getElementById('updateAppointmentModal');
        const updateAppointmentForm = document.getElementById('updateAppointmentForm');
        const closeUpdateAppointmentBtn = document.getElementById('closeUpdateAppointmentBtn');
        const updateAppointmentId = document.getElementById('updateAppointmentId');
        
        // ... (all other DOM elements remain the same as before) ...

        // ===== Helper Functions =====
        function formatDate(date) {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }
        
        function formatShortDate(date) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }
        
        function formatDateForInput(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toISOString().split('T')[0];
        }
        
        function formatTime(timeString) {
            const [hours, minutes] = timeString.split(':');
            const hour = parseInt(hours);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const displayHour = hour % 12 || 12;
            return `${displayHour}:${minutes} ${ampm}`;
        }

        function updateDateTime() {
            const now = new Date();
            
            const dateOptions = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            };
            
            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            
            currentDate.textContent = now.toLocaleDateString('en-US', dateOptions);
            currentTime.textContent = now.toLocaleTimeString('en-US', timeOptions);
        }

        // Update time every second
        setInterval(updateDateTime, 1000);
        
        function showAlert(type, title, message, options = {}) {
            // Clear previous actions
            alertActions.innerHTML = '';
            
            // Set icon and title
            alertIcon.className = 'alert-icon';
            switch(type) {
                case 'success':
                    alertIcon.innerHTML = '<i class="fas fa-check-circle"></i>';
                    alertIcon.classList.add('success');
                    break;
                case 'error':
                    alertIcon.innerHTML = '<i class="fas fa-exclamation-circle"></i>';
                    alertIcon.classList.add('error');
                    break;
                case 'warning':
                    alertIcon.innerHTML = '<i class="fas fa-exclamation-triangle"></i>';
                    alertIcon.classList.add('warning');
                    break;
                case 'info':
                    alertIcon.innerHTML = '<i class="fas fa-info-circle"></i>';
                    alertIcon.classList.add('info');
                    break;
            }
            
            alertTitle.textContent = title;
            alertMessage.textContent = message;
            
            // Add buttons based on options
            if (options.confirm) {
                const confirmBtn = document.createElement('button');
                confirmBtn.className = 'btn btn-confirm';
                confirmBtn.innerHTML = options.confirmText || 'Confirm';
                confirmBtn.onclick = options.onConfirm || (() => alertModal.classList.add('hidden'));
                
                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'btn btn-cancel';
                cancelBtn.innerHTML = options.cancelText || 'Cancel';
                cancelBtn.onclick = options.onCancel || (() => alertModal.classList.add('hidden'));
                
                alertActions.appendChild(confirmBtn);
                alertActions.appendChild(cancelBtn);
            } else {
                const okBtn = document.createElement('button');
                okBtn.className = 'btn btn-ok';
                okBtn.innerHTML = options.okText || 'OK';
                okBtn.onclick = options.onOk || (() => alertModal.classList.add('hidden'));
                alertActions.appendChild(okBtn);
            }
            
            // Show modal
            alertModal.classList.remove('hidden');
        }
        
        function showView(viewName) {
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.view === viewName) {
                    item.classList.add('active');
                }
            });
            
            // Update page title
            const pageTitle = document.getElementById('pageTitle');
            switch(viewName) {
                case 'dashboard':
                    pageTitle.textContent = 'Dashboard';
                    break;
                case 'addRecord':
                    pageTitle.textContent = 'Add New Record';
                    break;
                case 'medicalRecords':
                    pageTitle.textContent = 'Medical Records';
                    break;
                case 'dentalRecords':
                    pageTitle.textContent = 'Dental Records';
                    break;
                case 'appointmentSchedule':
                    pageTitle.textContent = 'Appointment Scheduling';
                    break;
                case 'medicalCertificate':
                    pageTitle.textContent = 'Medical Certificate';
                    break;
                case 'createReport':
                    pageTitle.textContent = 'Create Report';
                    break;
            }
            
            // Hide all views
            document.querySelectorAll('.view-content').forEach(view => {
                view.classList.add('hidden');
            });
            
            // Show selected view
            document.getElementById(`${viewName}View`).classList.remove('hidden');
            currentView = viewName;
            
            // Load data for the view if needed
            if (viewName === 'dashboard') {
                loadDashboardData();
            } else if (viewName === 'medicalRecords') {
                loadMedicalRecords();
            } else if (viewName === 'dentalRecords') {
                loadDentalRecords();
            } else if (viewName === 'appointmentSchedule') {
                loadAppointments();
                renderCalendar();
            } else if (viewName === 'medicalCertificate') {
                loadCertificateData();
            } else if (viewName === 'createReport') {
                loadReportData();
            }
        }

        function generateId() {
            return 'REC' + Date.now().toString().substr(-6) + Math.floor(Math.random() * 1000).toString().padStart(3, '0');
        }
        
        function clearAddRecordForm() {
            recordForm.reset();
            photoBase64 = null;
            photoPreview.innerHTML = '<i class="fas fa-user fa-3x" style="color: #ccc;"></i>';
            
            // Set current date
            const now = new Date();
            recordDate.value = formatDate(now);
        }

        // ===== Authentication Functions =====
        let isLoginMode = true;
        
        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            
            if (isLoginMode) {
                authTitle.textContent = 'Login to DHRM System';
                authSubtitle.textContent = 'Digital Health Records Management System';
                nameGroup.classList.add('hidden');
                confirmPasswordGroup.classList.add('hidden');
                authSubmit.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
                authToggleText.textContent = "Don't have an account?";
                authToggleLink.textContent = 'Sign up here';
            } else {
                authTitle.textContent = 'Create Admin Account';
                authSubtitle.textContent = 'Register for Digital Health Records Management System';
                nameGroup.classList.remove('hidden');
                confirmPasswordGroup.classList.remove('hidden');
                authSubmit.innerHTML = '<i class="fas fa-user-plus"></i> Sign Up';
                authToggleText.textContent = "Already have an account?";
                authToggleLink.textContent = 'Login here';
            }
            
            // Clear form
            authForm.reset();
            authError.style.display = 'none';
        }
        
        async function handleAuthSubmit(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showAlert('error', 'Validation Error', 'Please fill in all required fields');
                return;
            }
            
            if (!isLoginMode) {
                const name = document.getElementById('name').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (!name) {
                    showAlert('error', 'Validation Error', 'Please enter your full name');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showAlert('error', 'Validation Error', 'Passwords do not match');
                    return;
                }
                
                if (password.length < 6) {
                    showAlert('error', 'Validation Error', 'Password must be at least 6 characters');
                    return;
                }
                
                try {
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    await userCredential.user.updateProfile({ displayName: name });
                    
                    // Create user document in Firestore
                    await db.collection('users').doc(userCredential.user.uid).set({
                        name: name,
                        email: email,
                        role: 'admin',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    showAlert('success', 'Account Created', 'Account created successfully! You can now login.', {
                        onOk: () => {
                            alertModal.classList.add('hidden');
                            toggleAuthMode();
                        }
                    });
                } catch (error) {
                    showAlert('error', 'Registration Error', error.message);
                }
            } else {
                try {
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (error) {
                    showAlert('error', 'Login Error', error.message);
                }
            }
        }
        
        async function handleGoogleSignIn() {
            const provider = new firebase.auth.GoogleAuthProvider();
            
            try {
                const result = await auth.signInWithPopup(provider);
                const user = result.user;
                
                // Check if user exists in Firestore
                const userDoc = await db.collection('users').doc(user.uid).get();
                
                if (!userDoc.exists) {
                    // Create user document
                    await db.collection('users').doc(user.uid).set({
                        name: user.displayName,
                        email: user.email,
                        role: 'admin',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
            } catch (error) {
                showAlert('error', 'Google Sign-In Error', error.message);
            }
        }
        
        async function handleLogout() {
            try {
                await auth.signOut();
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // ===== Appointment Scheduling Functions =====
        async function loadAppointments() {
            try {
                const snapshot = await db.collection('appointments')
                    .orderBy('date', 'desc')
                    .orderBy('time', 'desc')
                    .get();
                
                appointments = [];
                snapshot.forEach(doc => {
                    appointments.push({ id: doc.id, ...doc.data() });
                });
                
                renderAppointmentsTable();
                updateDashboardAppointmentCount();
            } catch (error) {
                console.error('Error loading appointments:', error);
                showAlert('error', 'Data Load Error', 'Failed to load appointments: ' + error.message);
            }
        }

        function renderCalendar() {
            const firstDay = new Date(currentCalendarYear, currentCalendarMonth, 1);
            const lastDay = new Date(currentCalendarYear, currentCalendarMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();
            
            currentMonthYear.textContent = firstDay.toLocaleDateString('en-US', { 
                month: 'long', 
                year: 'numeric' 
            });
            
            // Clear calendar
            appointmentCalendar.innerHTML = '';
            
            // Add day headers
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            days.forEach(day => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = day;
                appointmentCalendar.appendChild(header);
            });
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < startingDay; i++) {
                const emptyCell = document.createElement('div');
                emptyCell.className = 'calendar-day disabled';
                appointmentCalendar.appendChild(emptyCell);
            }
            
            // Add days of the month
            const today = new Date();
            const isCurrentMonth = today.getMonth() === currentCalendarMonth && 
                                  today.getFullYear() === currentCalendarYear;
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                const currentDate = new Date(currentCalendarYear, currentCalendarMonth, day);
                
                // Check if it's today
                if (isCurrentMonth && day === today.getDate()) {
                    dayElement.classList.add('today');
                }
                
                // Check if it's selected
                if (selectedAppointmentDate && 
                    selectedAppointmentDate.getDate() === day &&
                    selectedAppointmentDate.getMonth() === currentCalendarMonth &&
                    selectedAppointmentDate.getFullYear() === currentCalendarYear) {
                    dayElement.classList.add('selected');
                }
                
                // Count appointments for this day
                const dayAppointments = appointments.filter(apt => {
                    const aptDate = new Date(apt.date);
                    return aptDate.getDate() === day &&
                           aptDate.getMonth() === currentCalendarMonth &&
                           aptDate.getFullYear() === currentCalendarYear;
                });
                
                const dateSpan = document.createElement('div');
                dateSpan.className = 'date';
                dateSpan.textContent = day;
                
                const countSpan = document.createElement('div');
                countSpan.className = 'appointments-count';
                countSpan.textContent = dayAppointments.length > 0 ? 
                    `${dayAppointments.length} apt${dayAppointments.length > 1 ? 's' : ''}` : 
                    '';
                
                dayElement.appendChild(dateSpan);
                dayElement.appendChild(countSpan);
                
                dayElement.addEventListener('click', () => {
                    selectedAppointmentDate = currentDate;
                    showDayAppointments(dayAppointments);
                    renderCalendar(); // Re-render to update selected state
                });
                
                appointmentCalendar.appendChild(dayElement);
            }
        }

        function showDayAppointments(dayAppointments) {
            if (dayAppointments.length === 0) {
                appointmentDetails.innerHTML = `
                    <h3>Appointments for ${selectedAppointmentDate.toLocaleDateString('en-US', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    })}</h3>
                    <p>No appointments scheduled for this day.</p>
                    <button class="btn btn-primary" id="scheduleForThisDayBtn" style="margin-top: 15px;">
                        <i class="fas fa-calendar-plus"></i> Schedule Appointment
                    </button>
                `;
                
                document.getElementById('scheduleForThisDayBtn').addEventListener('click', () => {
                    newAppointmentModal.classList.remove('hidden');
                    document.getElementById('appointmentDate').value = 
                        selectedAppointmentDate.toISOString().split('T')[0];
                });
            } else {
                let html = `<h3>Appointments for ${selectedAppointmentDate.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                })}</h3>`;
                
                dayAppointments.forEach(apt => {
                    const statusClass = `status-${apt.status.toLowerCase()}`;
                    html += `
                        <div style="margin-bottom: 15px; padding: 15px; border: 1px solid var(--border-color); border-radius: var(--radius);">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>${apt.patientName}</strong><br>
                                    <small>${formatTime(apt.time)}  ${apt.type}</small>
                                </div>
                                <span class="appointment-status ${statusClass}">${apt.status}</span>
                            </div>
                            <p style="margin-top: 10px; margin-bottom: 5px;">${apt.reason}</p>
                            <div class="appointment-actions">
                                <button class="action-btn btn-view" onclick="viewAppointment('${apt.id}')">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="action-btn btn-update" onclick="openUpdateAppointment('${apt.id}')">
                                    <i class="fas fa-edit"></i> Update
                                </button>
                                <button class="action-btn btn-delete" onclick="deleteAppointment('${apt.id}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                    <button class="btn btn-primary" id="scheduleForThisDayBtn" style="margin-top: 15px;">
                        <i class="fas fa-calendar-plus"></i> Add New Appointment
                    </button>
                `;
                
                appointmentDetails.innerHTML = html;
                
                document.getElementById('scheduleForThisDayBtn').addEventListener('click', () => {
                    newAppointmentModal.classList.remove('hidden');
                    document.getElementById('appointmentDate').value = 
                        selectedAppointmentDate.toISOString().split('T')[0];
                });
            }
        }

        function renderAppointmentsTable() {
            const searchTerm = searchAppointments.value.toLowerCase();
            const filteredAppointments = appointments.filter(apt => {
                return apt.patientName.toLowerCase().includes(searchTerm) ||
                       apt.type.toLowerCase().includes(searchTerm) ||
                       apt.status.toLowerCase().includes(searchTerm);
            });
            
            appointmentsTableBody.innerHTML = '';
            
            if (filteredAppointments.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" style="text-align: center;">No appointments found</td>`;
                appointmentsTableBody.appendChild(row);
            } else {
                filteredAppointments.forEach(apt => {
                    const row = document.createElement('tr');
                    const aptDate = new Date(apt.date);
                    const formattedDate = formatShortDate(aptDate);
                    const formattedTime = formatTime(apt.time);
                    const statusClass = `status-${apt.status.toLowerCase()}`;
                    
                    row.innerHTML = `
                        <td>${apt.patientName}</td>
                        <td>${formattedDate} at ${formattedTime}</td>
                        <td>${apt.type}</td>
                        <td><span class="appointment-status ${statusClass}">${apt.status}</span></td>
                        <td>
                            <button class="action-btn btn-view" onclick="viewAppointment('${apt.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                            <button class="action-btn btn-update" onclick="openUpdateAppointment('${apt.id}')">
                                <i class="fas fa-edit"></i> Update
                            </button>
                            <button class="action-btn btn-delete" onclick="deleteAppointment('${apt.id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </td>
                    `;
                    appointmentsTableBody.appendChild(row);
                });
            }
        }

        async function scheduleNewAppointment(e) {
            e.preventDefault();
            
            const formData = {
                patientName: document.getElementById('appointmentPatientName').value.trim(),
                contactNumber: document.getElementById('appointmentPatientContact').value.trim(),
                date: document.getElementById('appointmentDate').value,
                time: document.getElementById('appointmentTime').value,
                type: document.getElementById('appointmentType').value,
                department: document.getElementById('appointmentDepartment').value,
                reason: document.getElementById('appointmentReason').value.trim(),
                notes: document.getElementById('appointmentNotes').value.trim(),
                status: 'Pending',
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                createdBy: currentUser?.uid || null
            };
            
            // Validation
            if (!formData.patientName || !formData.contactNumber || !formData.date || 
                !formData.time || !formData.type || !formData.department || !formData.reason) {
                showAlert('error', 'Validation Error', 'Please fill in all required fields.');
                return;
            }
            
            // Check if date is in the past
            const appointmentDate = new Date(formData.date);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (appointmentDate < today) {
                showAlert('error', 'Invalid Date', 'Cannot schedule appointments in the past.');
                return;
            }
            
            try {
                // Check for conflicting appointments
                const conflictingAppointments = appointments.filter(apt => {
                    return apt.date === formData.date && apt.time === formData.time;
                });
                
                if (conflictingAppointments.length > 0) {
                    showAlert('error', 'Time Conflict', 'This time slot is already booked. Please choose a different time.');
                    return;
                }
                
                // Save to Firestore
                await db.collection('appointments').add(formData);
                
                showAlert('success', 'Appointment Scheduled', 'Appointment scheduled successfully!', {
                    onOk: () => {
                        alertModal.classList.add('hidden');
                        newAppointmentModal.classList.add('hidden');
                        newAppointmentForm.reset();
                        
                        // Refresh appointments
                        loadAppointments();
                        renderCalendar();
                    }
                });
            } catch (error) {
                console.error('Error scheduling appointment:', error);
                showAlert('error', 'Scheduling Error', 'Error scheduling appointment: ' + error.message);
            }
        }

        async function viewAppointment(appointmentId) {
            try {
                const appointment = appointments.find(apt => apt.id === appointmentId);
                if (!appointment) {
                    showAlert('error', 'Not Found', 'Appointment not found.');
                    return;
                }
                
                const aptDate = new Date(appointment.date);
                const formattedDate = formatDate(aptDate);
                const formattedTime = formatTime(appointment.time);
                const statusClass = `status-${appointment.status.toLowerCase()}`;
                
                showAlert('info', 'Appointment Details', `
                    <div style="text-align: left;">
                        <p><strong>Patient:</strong> ${appointment.patientName}</p>
                        <p><strong>Contact:</strong> ${appointment.contactNumber}</p>
                        <p><strong>Date:</strong> ${formattedDate}</p>
                        <p><strong>Time:</strong> ${formattedTime}</p>
                        <p><strong>Type:</strong> ${appointment.type}</p>
                        <p><strong>Department:</strong> ${appointment.department}</p>
                        <p><strong>Status:</strong> <span class="appointment-status ${statusClass}">${appointment.status}</span></p>
                        <p><strong>Reason:</strong> ${appointment.reason}</p>
                        ${appointment.notes ? `<p><strong>Notes:</strong> ${appointment.notes}</p>` : ''}
                    </div>
                `, {
                    onOk: () => alertModal.classList.add('hidden')
                });
            } catch (error) {
                console.error('Error viewing appointment:', error);
                showAlert('error', 'View Error', 'Error viewing appointment: ' + error.message);
            }
        }

        async function openUpdateAppointment(appointmentId) {
            try {
                const appointment = appointments.find(apt => apt.id === appointmentId);
                if (!appointment) {
                    showAlert('error', 'Not Found', 'Appointment not found.');
                    return;
                }
                
                currentAppointmentId = appointmentId;
                
                // Populate form
                updateAppointmentId.value = appointmentId;
                updateAppointmentPatientName.value = appointment.patientName;
                updateAppointmentPatientContact.value = appointment.contactNumber;
                updateAppointmentDate.value = appointment.date;
                updateAppointmentTime.value = appointment.time;
                updateAppointmentType.value = appointment.type;
                updateAppointmentDepartment.value = appointment.department;
                updateAppointmentReason.value = appointment.reason;
                updateAppointmentNotes.value = appointment.notes || '';
                updateAppointmentStatus.value = appointment.status;
                
                updateAppointmentModal.classList.remove('hidden');
            } catch (error) {
                console.error('Error opening update appointment:', error);
                showAlert('error', 'Update Error', 'Error opening update form: ' + error.message);
            }
        }

        async function updateAppointmentFormSubmit(e) {
            e.preventDefault();
            
            const formData = {
                patientName: updateAppointmentPatientName.value.trim(),
                contactNumber: updateAppointmentPatientContact.value.trim(),
                date: updateAppointmentDate.value,
                time: updateAppointmentTime.value,
                type: updateAppointmentType.value,
                department: updateAppointmentDepartment.value,
                reason: updateAppointmentReason.value.trim(),
                notes: updateAppointmentNotes.value.trim(),
                status: updateAppointmentStatus.value,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedBy: currentUser?.uid || null
            };
            
            // Validation
            if (!formData.patientName || !formData.contactNumber || !formData.date || 
                !formData.time || !formData.type || !formData.department || !formData.reason || !formData.status) {
                showAlert('error', 'Validation Error', 'Please fill in all required fields.');
                return;
            }
            
            try {
                // Check for conflicting appointments (excluding current appointment)
                const conflictingAppointments = appointments.filter(apt => {
                    return apt.id !== currentAppointmentId && 
                           apt.date === formData.date && 
                           apt.time === formData.time;
                });
                
                if (conflictingAppointments.length > 0) {
                    showAlert('error', 'Time Conflict', 'This time slot is already booked by another appointment.');
                    return;
                }
                
                // Update in Firestore
                await db.collection('appointments').doc(currentAppointmentId).update(formData);
                
                showAlert('success', 'Appointment Updated', 'Appointment updated successfully!', {
                    onOk: () => {
                        alertModal.classList.add('hidden');
                        updateAppointmentModal.classList.add('hidden');
                        updateAppointmentForm.reset();
                        
                        // Refresh appointments
                        loadAppointments();
                        renderCalendar();
                    }
                });
            } catch (error) {
                console.error('Error updating appointment:', error);
                showAlert('error', 'Update Error', 'Error updating appointment: ' + error.message);
            }
        }

        async function deleteAppointment(appointmentId) {
            showAlert('warning', 'Confirm Delete', 'Are you sure you want to delete this appointment?', {
                confirm: true,
                confirmText: 'Delete',
                cancelText: 'Cancel',
                onConfirm: async () => {
                    try {
                        await db.collection('appointments').doc(appointmentId).delete();
                        
                        // Remove from local array
                        appointments = appointments.filter(apt => apt.id !== appointmentId);
                        
                        showAlert('success', 'Appointment Deleted', 'Appointment deleted successfully!', {
                            onOk: () => {
                                alertModal.classList.add('hidden');
                                loadAppointments();
                                renderCalendar();
                            }
                        });
                    } catch (error) {
                        console.error('Error deleting appointment:', error);
                        showAlert('error', 'Delete Error', 'Error deleting appointment: ' + error.message);
                    }
                },
                onCancel: () => {
                    alertModal.classList.add('hidden');
                }
            });
        }

        function updateDashboardAppointmentCount() {
            const today = new Date().toISOString().split('T')[0];
            const todayAppointments = appointments.filter(apt => apt.date === today);
            appointmentCount.textContent = todayAppointments.length;
        }

// ===== Data Management Functions =====
async function loadDashboardData() {
    try {
        // Load admin count
        const usersSnapshot = await db.collection('users').get();
        adminCount.textContent = usersSnapshot.size;
        
        // Load records
        const recordsSnapshot = await db.collection('records').orderBy('createdAt', 'desc').get();
        const records = [];
        recordsSnapshot.forEach(doc => {
            records.push({ id: doc.id, ...doc.data() });
        });
        
        allRecords = records;
        // REMOVE THIS LINE: totalRecords.textContent = records.length;
        
        // Calculate report count (medical + dental)
        const medicalRecordsCount = records.filter(r => r.categoryType === 'Medical').length;
        const dentalRecordsCount = records.filter(r => r.categoryType === 'Dental').length;
        reportCount.textContent = medicalRecordsCount + dentalRecordsCount;
        
        // Get last record date
        if (records.length > 0) {
            const lastRecord = records[0];
            const date = lastRecord.createdAt ? lastRecord.createdAt.toDate() : new Date();
            lastRecordDate.textContent = formatShortDate(date);
        } else {
            lastRecordDate.textContent = 'N/A';
        }
        
        // Load appointments count
        await loadAppointments();
        
        // Load chart data
        loadChartData(records);
    } catch (error) {
        console.error('Error loading dashboard data:', error);
        showAlert('error', 'Data Load Error', 'Failed to load dashboard data: ' + error.message);
    }
}
        
        function loadChartData(records) {
            const selectedYear = parseInt(yearSelector.value);
            const monthlyData = new Array(12).fill(0);
            
            records.forEach(record => {
                if (record.createdAt) {
                    const date = record.createdAt.toDate();
                    if (date.getFullYear() === selectedYear) {
                        monthlyData[date.getMonth()]++;
                    }
                }
            });
            
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                           'July', 'August', 'September', 'October', 'November', 'December'];
            
            const ctx = document.getElementById('dataChart').getContext('2d');
            
            if (dataChart) {
                dataChart.destroy();
            }
            
            dataChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Data Record',
                        data: monthlyData,
                        backgroundColor: 'rgba(26, 115, 232, 0.7)',
                        borderColor: 'rgba(26, 115, 232, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 3,
                            ticks: {
                                stepSize: 1
                            }
                        },
                        x: {
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }
        
        async function submitRecordForm(e) {
            e.preventDefault();
            
            // Get form values
            const formData = {
                name: document.getElementById('patientName').value.trim(),
                age: parseInt(document.getElementById('patientAge').value),
                contactNumber: document.getElementById('contactNumber').value.trim(),
                homeAddress: document.getElementById('homeAddress').value.trim(),
                date: new Date().toISOString(),
                birthday: document.getElementById('birthday').value,
                sex: document.getElementById('sex').value,
                patientType: document.getElementById('patientType').value,
                department: document.getElementById('department').value,
                course: document.getElementById('course').value.trim(),
                categoryType: document.getElementById('categoryType').value,
                diagnoses: document.getElementById('diagnoses').value.trim(),
                medicine: document.getElementById('medicine').value.trim(),
                remarks: document.getElementById('remarks').value.trim(),
                photo: photoBase64,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                createdBy: currentUser.uid
            };
            
            // Validate required fields
            if (!formData.name || !formData.age || !formData.contactNumber || !formData.homeAddress || 
                !formData.sex || !formData.patientType || !formData.department || !formData.categoryType ||
                !formData.diagnoses || !formData.medicine || !formData.course) {
                showAlert('error', 'Validation Error', 'Please fill in all required fields');
                return;
            }
            
            if (formData.age < 1 || formData.age > 120) {
                showAlert('error', 'Validation Error', 'Age must be between 1 and 120');
                return;
            }
            
            try {
                // Generate ID for the document
                const recordId = generateId();
                console.log('Saving record with ID:', recordId);
                
                // Store the ID in the document data
                formData.recordId = recordId;
                
                // Save to Firestore with the generated ID as the document ID
                await db.collection('records').doc(recordId).set(formData);
                
                // Show success message
                showAlert('success', 'Record Added', 'Record added successfully!', {
                    onOk: () => {
                        alertModal.classList.add('hidden');
                        clearAddRecordForm();
                        
                        // Refresh views
                        if (currentView === 'medicalRecords' || currentView === 'dentalRecords' || currentView === 'dashboard') {
                            showView(currentView);
                        }
                    }
                });
            } catch (error) {
                console.error('Error adding record:', error);
                showAlert('error', 'Save Error', 'Error adding record: ' + error.message);
            }
        }
        
        async function loadMedicalRecords() {
            try {
                medicalLoading.classList.remove('hidden');
                medicalTable.classList.add('hidden');
                
                const snapshot = await db.collection('records')
                    .where('categoryType', 'in', ['Medical', 'Consultation', 'Emergency'])
                    .orderBy('createdAt', 'desc')
                    .get();
                
                medicalRecords = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    // Use recordId from data if available, otherwise use doc.id
                    const recordWithId = { 
                        id: data.recordId || doc.id, // Use recordId field first, fallback to doc.id
                        ...data 
                    };
                    medicalRecords.push(recordWithId);
                });
                
                // Also update allRecords for consistency
                const allRecordsSnapshot = await db.collection('records').orderBy('createdAt', 'desc').get();
                allRecords = [];
                allRecordsSnapshot.forEach(doc => {
                    const data = doc.data();
                    allRecords.push({ 
                        id: data.recordId || doc.id, // Use recordId field first, fallback to doc.id
                        ...data 
                    });
                });
                
                medicalLoading.classList.add('hidden');
                medicalTable.classList.remove('hidden');
                
                renderMedicalTable();
            } catch (error) {
                console.error('Error loading medical records:', error);
                medicalLoading.innerHTML = 'Error loading medical records';
                showAlert('error', 'Data Load Error', 'Failed to load medical records: ' + error.message);
            }
        }
        
        function renderMedicalTable() {
            const searchTerm = searchMedical.value.toLowerCase();
            const filteredRecords = medicalRecords.filter(record => {
                return record.name.toLowerCase().includes(searchTerm) ||
                       (record.id && record.id.toLowerCase().includes(searchTerm)) ||
                       record.homeAddress.toLowerCase().includes(searchTerm);
            });
            
            const startIndex = (medicalCurrentPage - 1) * medicalEntriesPerPage;
            const endIndex = startIndex + medicalEntriesPerPage;
            const paginatedRecords = filteredRecords.slice(startIndex, endIndex);
            
            // Clear table body
            medicalTableBody.innerHTML = '';
            
            if (paginatedRecords.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" style="text-align: center;">No records found</td>`;
                medicalTableBody.appendChild(row);
            } else {
                paginatedRecords.forEach(record => {
                    const row = document.createElement('tr');
                    
                    // Format date
                    const date = record.createdAt ? record.createdAt.toDate() : new Date();
                    const formattedDate = formatShortDate(date);
                    
                    row.innerHTML = `
                        <td>${record.name}</td>
                        <td>${record.sex}</td>
                        <td>${formattedDate}</td>
                        <td>${record.homeAddress.substring(0, 30)}${record.homeAddress.length > 30 ? '...' : ''}</td>
                        <td>
                            <button class="action-btn btn-view" onclick="viewPatientRecord('${record.id}')">View</button>
                            <button class="action-btn btn-update" onclick="updateRecord('${record.id}')">Update</button>
                            <button class="action-btn btn-delete" onclick="deleteRecord('${record.id}')">Delete</button>
                        </td>
                    `;
                    
                    medicalTableBody.appendChild(row);
                });
            }
            
            // Update pagination info
            const totalPages = Math.ceil(filteredRecords.length / medicalEntriesPerPage);
            medicalPaginationInfo.textContent = `Showing ${startIndex + 1} to ${Math.min(endIndex, filteredRecords.length)} of ${filteredRecords.length} entries`;
            
            // Update pagination buttons
            medicalPrevBtn.disabled = medicalCurrentPage === 1;
            medicalNextBtn.disabled = medicalCurrentPage >= totalPages || totalPages === 0;
        }
        
        async function loadDentalRecords() {
            try {
                dentalLoading.classList.remove('hidden');
                dentalTable.classList.add('hidden');
                
                const snapshot = await db.collection('records')
                    .where('categoryType', '==', 'Dental')
                    .orderBy('createdAt', 'desc')
                    .get();
                
                dentalRecords = [];
                snapshot.forEach(doc => {
                    dentalRecords.push({ id: doc.id, ...doc.data() });
                });
                
                dentalLoading.classList.add('hidden');
                dentalTable.classList.remove('hidden');
                
                renderDentalTable();
            } catch (error) {
                console.error('Error loading dental records:', error);
                dentalLoading.innerHTML = 'Error loading dental records';
                showAlert('error', 'Data Load Error', 'Failed to load dental records: ' + error.message);
            }
        }
        
        function renderDentalTable() {
            const searchTerm = searchDental.value.toLowerCase();
            const filteredRecords = dentalRecords.filter(record => {
                return record.name.toLowerCase().includes(searchTerm) ||
                       (record.id && record.id.toLowerCase().includes(searchTerm)) ||
                       record.homeAddress.toLowerCase().includes(searchTerm);
            });
            
            const startIndex = (dentalCurrentPage - 1) * dentalEntriesPerPage;
            const endIndex = startIndex + dentalEntriesPerPage;
            const paginatedRecords = filteredRecords.slice(startIndex, endIndex);
            
            // Clear table body
            dentalTableBody.innerHTML = '';
            
            if (paginatedRecords.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" style="text-align: center;">No records found</td>`;
                dentalTableBody.appendChild(row);
            } else {
                paginatedRecords.forEach(record => {
                    const row = document.createElement('tr');
                    
                    // Format date
                    const date = record.createdAt ? record.createdAt.toDate() : new Date();
                    const formattedDate = formatShortDate(date);
                    
                    row.innerHTML = `
                        <td>${record.name}</td>
                        <td>${record.sex}</td>
                        <td>${formattedDate}</td>
                        <td>${record.homeAddress.substring(0, 30)}${record.homeAddress.length > 30 ? '...' : ''}</td>
                        <td>
                            <button class="action-btn btn-view" onclick="viewPatientRecord('${record.id}')">View</button>
                            <button class="action-btn btn-update" onclick="updateRecord('${record.id}')">Update</button>
                            <button class="action-btn btn-delete" onclick="deleteRecord('${record.id}')">Delete</button>
                        </td>
                    `;
                    
                    dentalTableBody.appendChild(row);
                });
            }
            
            // Update pagination info
            const totalPages = Math.ceil(filteredRecords.length / dentalEntriesPerPage);
            dentalPaginationInfo.textContent = `Showing ${startIndex + 1} to ${Math.min(endIndex, filteredRecords.length)} of ${filteredRecords.length} entries`;
            
            // Update pagination buttons
            dentalPrevBtn.disabled = dentalCurrentPage === 1;
            dentalNextBtn.disabled = dentalCurrentPage >= totalPages || totalPages === 0;
        }
        
        async function loadCertificateData() {
            try {
                certificateLoading.classList.remove('hidden');
                const certificateTable = document.getElementById('certificateTable');
                certificateTable.classList.add('hidden');
                
                const snapshot = await db.collection('records').orderBy('createdAt', 'desc').get();
                const records = [];
                snapshot.forEach(doc => {
                    records.push({ id: doc.id, ...doc.data() });
                });
                
                certificateLoading.classList.add('hidden');
                certificateTable.classList.remove('hidden');
                
                renderCertificateTable(records);
                renderIndividualReportTable(records);
            } catch (error) {
                console.error('Error loading certificate data:', error);
                certificateLoading.innerHTML = 'Error loading patient records';
                showAlert('error', 'Data Load Error', 'Failed to load patient records: ' + error.message);
            }
        }
        
        function renderCertificateTable(records) {
            const searchTerm = searchCertificate.value.toLowerCase();
            const filteredRecords = records.filter(record => {
                return record.name.toLowerCase().includes(searchTerm) ||
                       (record.id && record.id.toLowerCase().includes(searchTerm)) ||
                       record.department.toLowerCase().includes(searchTerm);
            });
            
            // Clear table body
            certificateTableBody.innerHTML = '';
            
            if (filteredRecords.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" style="text-align: center;">No patient records found</td>`;
                certificateTableBody.appendChild(row);
            } else {
                filteredRecords.forEach(record => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${record.name}</td>
                        <td>${record.sex}</td>
                        <td>${record.patientType}</td>
                        <td>${record.department}</td>
                        <td>
                            <button class="action-btn btn-view" onclick="generateStandardCertificate('${record.id}')">
                                <i class="fas fa-certificate"></i> Generate Certificate
                            </button>
                        </td>
                    `;
                    
                    certificateTableBody.appendChild(row);
                });
            }
        }
        
        function renderIndividualReportTable(records) {
            const searchTerm = searchIndividualReport.value.toLowerCase();
            const filteredRecords = records.filter(record => {
                return record.name.toLowerCase().includes(searchTerm) ||
                       (record.id && record.id.toLowerCase().includes(searchTerm)) ||
                       record.department.toLowerCase().includes(searchTerm);
            });
            
            // Clear table body
            individualReportTableBody.innerHTML = '';
            
            if (filteredRecords.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" style="text-align: center;">No patient records found</td>`;
                individualReportTableBody.appendChild(row);
            } else {
                filteredRecords.forEach(record => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${record.name}</td>
                        <td>${record.sex}</td>
                        <td>${record.age}</td>
                        <td>${record.department}</td>
                        <td>
                            <button class="action-btn btn-view" onclick="generateIndividualReport('${record.id}')">
                                <i class="fas fa-file-medical"></i> Generate Report
                            </button>
                        </td>
                    `;
                    
                    individualReportTableBody.appendChild(row);
                });
            }
        }
        
        async function loadReportData() {
            try {
                reportLoading.classList.remove('hidden');
                reportTable.classList.add('hidden');
                
                const snapshot = await db.collection('records').orderBy('createdAt', 'desc').get();
                
                const records = [];
                snapshot.forEach(doc => {
                    records.push({ id: doc.id, ...doc.data() });
                });
                
                reportLoading.classList.add('hidden');
                reportTable.classList.remove('hidden');
                
                renderReportTable(records);
            } catch (error) {
                console.error('Error loading report data:', error);
                reportLoading.innerHTML = 'Error loading report data';
                showAlert('error', 'Data Load Error', 'Failed to load report data: ' + error.message);
            }
        }
        
        function renderReportTable(records) {
            const searchTerm = reportSearch.value.toLowerCase();
            const filteredRecords = records.filter(record => {
                return record.name.toLowerCase().includes(searchTerm) ||
                       (record.id && record.id.toLowerCase().includes(searchTerm)) ||
                       record.categoryType.toLowerCase().includes(searchTerm);
            });
            
            // Clear table body
            reportTableBody.innerHTML = '';
            
            if (filteredRecords.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" style="text-align: center;">No records found</td>`;
                reportTableBody.appendChild(row);
            } else {
                filteredRecords.forEach((record, index) => {
                    const row = document.createElement('tr');
                    
                    // Highlight the first row
                    if (index === 0) {
                        row.style.backgroundColor = 'var(--light-blue)';
                    }
                    
                    // Format date
                    const date = record.createdAt ? record.createdAt.toDate() : new Date();
                    const formattedDate = formatShortDate(date);
                    
                    row.innerHTML = `
                        <td>${record.name}</td>
                        <td>${record.sex}</td>
                        <td>${record.categoryType}</td>
                        <td>${record.age}</td>
                        <td>${formattedDate}</td>
                    `;
                    
                    reportTableBody.appendChild(row);
                });
            }
        }
        
        async function viewPatientRecord(recordId) {
            try {
                let record;
                
                // Try to find in local arrays first
                record = allRecords.find(r => r.id === recordId);
                
                if (!record) {
                    // Fetch from Firestore
                    const doc = await db.collection('records').doc(recordId).get();
                    if (doc.exists) {
                        record = { id: doc.id, ...doc.data() };
                    } else {
                        showAlert('error', 'Record Not Found', 'The requested record was not found.');
                        return;
                    }
                }
                
                currentPatientViewData = record;
                
                // Populate patient view modal
                viewPatientName.textContent = record.name;
                viewPatientAge.textContent = record.age;
                viewPatientSex.textContent = record.sex;
                viewCivilStatus.textContent = 'Single'; // Default value, can be updated in the record
                viewPatientBirthday.textContent = formatDateForInput(record.birthday);
                viewPatientContact.textContent = record.contactNumber;
                viewPatientDepartment.textContent = record.department;
                viewPatientCourse.textContent = record.course || 'N/A';
                viewPatientAddress.textContent = record.homeAddress;
                viewPatientGuardian.textContent = 'Parent/Guardian'; // Default value
                viewEmergencyContact.textContent = record.contactNumber;
                
                // Populate medical details
                viewComplaint.textContent = record.remarks || 'No complaint recorded';
                viewDiagnoses.textContent = record.diagnoses || 'No diagnosis recorded';
                viewTreatment.textContent = record.medicine || 'No treatment recorded';
                
                // Show patient view modal
                patientViewModal.classList.remove('hidden');
            } catch (error) {
                console.error('Error viewing patient record:', error);
                showAlert('error', 'View Error', 'Error viewing patient record: ' + error.message);
            }
        }
        
        async function generateStandardCertificate(recordId) {
            try {
                let record;
                
                // Try to find in local arrays first
                record = allRecords.find(r => r.id === recordId);
                
                if (!record) {
                    // Fetch from Firestore
                    const doc = await db.collection('records').doc(recordId).get();
                    if (doc.exists) {
                        record = { id: doc.id, ...doc.data() };
                    } else {
                        showAlert('error', 'Record Not Found', 'The requested record was not found.');
                        return;
                    }
                }
                
                currentCertificateData = record;
                
                // Populate certificate modal
                certPatientName.textContent = record.name;
                certPatientAge.textContent = record.age;
                certPatientCourse.textContent = record.course || 'N/A';
                
                const examDate = record.createdAt ? record.createdAt.toDate() : new Date();
                certExamDate.textContent = formatDate(examDate);
                
                // Populate editable fields with existing data
                editableDiagnoses.value = record.diagnoses || '';
                editableMedicine.value = record.medicine || '';
                editableRemarks.value = record.remarks || '';
                
                // Populate details
                detailName.textContent = record.name;
                detailAge.textContent = record.age;
                detailSex.textContent = record.sex;
                detailBirthday.textContent = formatDateForInput(record.birthday);
                detailContact.textContent = record.contactNumber;
                detailAddress.textContent = record.homeAddress;
                detailDepartment.textContent = record.department;
                detailCourse.textContent = record.course || 'N/A';
                detailCategory.textContent = record.categoryType;
                
                // Show certificate modal
                certificateModal.classList.remove('hidden');
            } catch (error) {
                console.error('Error generating certificate:', error);
                showAlert('error', 'Certificate Error', 'Error generating certificate: ' + error.message);
            }
        }
        
        async function generateIndividualReport(recordId) {
            // For individual report, we'll use the same viewPatientRecord function
            // but with a different layout. For now, we'll use the same modal.
            await viewPatientRecord(recordId);
        }
        
        async function submitUpdateForm(e) {
            e.preventDefault();
            
            console.log('Updating record ID:', currentRecordId);
            
            if (!currentRecordId) {
                showAlert('error', 'Update Error', 'No record selected for update.');
                return;
            }
            
            // Get form values
            const ageValue = parseInt(updatePatientAge.value);
            
            const formData = {
                name: updatePatientName.value.trim(),
                age: ageValue,
                contactNumber: updateContactNumber.value.trim(),
                homeAddress: updateHomeAddress.value.trim(),
                birthday: updateBirthday.value || null,
                sex: updateSex.value,
                patientType: updatePatientType.value,
                department: updateDepartment.value,
                course: updateCourse.value.trim(),
                categoryType: updateCategoryType.value,
                diagnoses: updateDiagnoses.value.trim(),
                medicine: updateMedicine.value.trim(),
                remarks: updateRemarks.value.trim(),
                photo: updatePhotoBase64,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
                updatedBy: currentUser?.uid || null
            };
            
            // Validation
            if (!formData.name || !formData.age || !formData.contactNumber || !formData.homeAddress || 
                !formData.sex || !formData.patientType || !formData.department || !formData.categoryType ||
                !formData.diagnoses || !formData.medicine || !formData.course) {
                showAlert('error', 'Validation Error', 'Please fill in all required fields.');
                return;
            }
            
            if (ageValue < 1 || ageValue > 120) {
                showAlert('error', 'Validation Error', 'Age must be between 1 and 120.');
                return;
            }
            
            try {
                console.log('Attempting to update document with ID:', currentRecordId);
                
                // First try to update using currentRecordId as document ID
                const docRef = db.collection('records').doc(currentRecordId);
                const docSnap = await docRef.get();
                
                if (docSnap.exists) {
                    // Document exists with this ID, update it
                    await docRef.update(formData);
                    console.log('Updated using document ID:', currentRecordId);
                } else {
                    // Document doesn't exist with this ID, try to find by recordId field
                    console.log('Document not found with ID, searching by recordId field...');
                    
                    const querySnapshot = await db.collection('records')
                        .where('recordId', '==', currentRecordId)
                        .limit(1)
                        .get();
                    
                    if (!querySnapshot.empty) {
                        const actualDocId = querySnapshot.docs[0].id;
                        await db.collection('records').doc(actualDocId).update(formData);
                        console.log('Updated using actual document ID:', actualDocId);
                    } else {
                        throw new Error('Document not found with ID or recordId: ' + currentRecordId);
                    }
                }
                
                // Update local records
                updateLocalRecord(currentRecordId, formData);
                
                showAlert('success', 'Record Updated', 'Record updated successfully!', {
                    onOk: () => {
                        alertModal.classList.add('hidden');
                        updateModal.classList.add('hidden');
                        
                        // Refresh current view
                        refreshCurrentView();
                    }
                });
                
            } catch (error) {
                console.error('Error updating record:', error);
                showAlert('error', 'Update Error', 'Error updating record: ' + error.message);
            }
        }
        
        // Helper function to update record in local arrays
        function updateLocalRecord(recordId, updatedData) {
            // Update in allRecords
            const recordIndex = allRecords.findIndex(r => r.id === recordId);
            if (recordIndex !== -1) {
                allRecords[recordIndex] = { ...allRecords[recordIndex], ...updatedData };
            }
            
            // Update in medicalRecords if it exists there
            const medicalIndex = medicalRecords.findIndex(r => r.id === recordId);
            if (medicalIndex !== -1) {
                medicalRecords[medicalIndex] = { ...medicalRecords[medicalIndex], ...updatedData };
            }
            
            // Update in dentalRecords if it exists there
            const dentalIndex = dentalRecords.findIndex(r => r.id === recordId);
            if (dentalIndex !== -1) {
                dentalRecords[dentalIndex] = { ...dentalRecords[dentalIndex], ...updatedData };
            }
        }
        
        // Helper function to refresh the current view
        function refreshCurrentView() {
            switch(currentView) {
                case 'medicalRecords':
                    renderMedicalTable();
                    break;
                case 'dentalRecords':
                    renderDentalTable();
                    break;
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'medicalCertificate':
                    loadCertificateData();
                    break;
                case 'createReport':
                    loadReportData();
                    break;
                case 'appointmentSchedule':
                    loadAppointments();
                    renderCalendar();
                    break;
            }
        }
        
        // ===== UPDATE RECORD FUNCTION =====
        async function updateRecord(recordId) {
            try {
                console.log('Looking for record with ID:', recordId);
                currentRecordId = recordId;
                
                if (!recordId) {
                    showAlert('error', 'Update Error', 'Invalid record ID.');
                    return;
                }
                
                // First, try to find in local arrays
                let record = allRecords.find(r => r.id === recordId);
                
                if (!record) {
                    // If not found, try to find by recordId field in Firestore
                    console.log('Not found locally, searching Firestore...');
                    
                    // Try direct document access first
                    const docSnap = await db.collection('records').doc(recordId).get();
                    
                    if (docSnap.exists) {
                        const data = docSnap.data();
                        record = { id: data.recordId || docSnap.id, ...data };
                    } else {
                        // Try querying by recordId field
                        const querySnapshot = await db.collection('records')
                            .where('recordId', '==', recordId)
                            .limit(1)
                            .get();
                        
                        if (!querySnapshot.empty) {
                            const doc = querySnapshot.docs[0];
                            const data = doc.data();
                            record = { id: data.recordId || doc.id, ...data };
                            // Update currentRecordId to the actual document ID
                            currentRecordId = doc.id;
                        } else {
                            showAlert('error', 'Record Not Found', 'Record not found in database.');
                            return;
                        }
                    }
                }
                
                console.log('Found record:', record);
                
                // Populate update form
                populateUpdateForm(record);
                
                // Show update modal
                updateModal.classList.remove('hidden');
                
            } catch (error) {
                console.error('Error in updateRecord:', error);
                showAlert('error', 'Update Error', 'Error: ' + error.message);
            }
        }
        
        // Helper function to populate update form
        function populateUpdateForm(record) {
            console.log('Populating form with record:', record);
            
            updateRecordId.value = record.id || '';
            updatePatientName.value = record.name || '';
            updatePatientAge.value = record.age || '';
            updateContactNumber.value = record.contactNumber || '';
            updateHomeAddress.value = record.homeAddress || '';
            
            const recordDateValue = record.createdAt?.toDate?.() || new Date();
            updateRecordDate.value = formatDate(recordDateValue);
            
            updateBirthday.value = record.birthday ? formatDateForInput(record.birthday) : '';
            updateSex.value = record.sex || '';
            updatePatientType.value = record.patientType || '';
            updateDepartment.value = record.department || '';
            updateCourse.value = record.course || '';
            updateCategoryType.value = record.categoryType || '';
            updateDiagnoses.value = record.diagnoses || '';
            updateMedicine.value = record.medicine || '';
            updateRemarks.value = record.remarks || '';
            
            // Handle photo
            if (record.photo) {
                updatePhotoPreview.innerHTML = `<img src="${record.photo}" alt="Patient Photo" />`;
                updatePhotoBase64 = record.photo;
            } else {
                updatePhotoPreview.innerHTML = '<i class="fas fa-user fa-3x" style="color:#ccc"></i>';
                updatePhotoBase64 = null;
            }
            
            console.log('Form populated successfully');
        }
        
        async function deleteRecord(recordId) {
            showAlert('warning', 'Confirm Delete', 'Are you sure you want to delete this record? This action cannot be undone.', {
                confirm: true,
                confirmText: 'Delete',
                cancelText: 'Cancel',
                onConfirm: async () => {
                    try {
                        // Delete from Firestore
                        await db.collection('records').doc(recordId).delete();
                        
                        // Find the record to get its category type
                        const recordToDelete = allRecords.find(r => r.id === recordId);
                        const categoryType = recordToDelete ? recordToDelete.categoryType : '';
                        
                        // Remove from local arrays
                        allRecords = allRecords.filter(r => r.id !== recordId);
                        medicalRecords = medicalRecords.filter(r => r.id !== recordId);
                        dentalRecords = dentalRecords.filter(r => r.id !== recordId);
                        
                        // Update dashboard statistics
                        await updateDashboardAfterDelete(categoryType);
                        
                        // Show success message
                        showAlert('success', 'Record Deleted', 'Record deleted successfully from all sections!', {
                            onOk: () => {
                                alertModal.classList.add('hidden');
                                
                                // Refresh all relevant views
                                refreshAllViews();
                            }
                        });
                    } catch (error) {
                        console.error('Error deleting record:', error);
                        showAlert('error', 'Delete Error', 'Error deleting record: ' + error.message);
                    }
                },
                onCancel: () => {
                    alertModal.classList.add('hidden');
                }
            });
        }
        
        // Helper function to update dashboard after delete
        async function updateDashboardAfterDelete(categoryType) {
            try {
                // Recalculate dashboard statistics
                const usersSnapshot = await db.collection('users').get();
                adminCount.textContent = usersSnapshot.size;
                
                const recordsSnapshot = await db.collection('records').orderBy('createdAt', 'desc').get();
                const records = [];
                recordsSnapshot.forEach(doc => {
                    records.push({ id: doc.id, ...doc.data() });
                });
                
                allRecords = records;
                totalRecords.textContent = records.length;
                
                // Calculate report count (medical + dental)
                const medicalRecordsCount = records.filter(r => r.categoryType === 'Medical').length;
                const dentalRecordsCount = records.filter(r => r.categoryType === 'Dental').length;
                reportCount.textContent = medicalRecordsCount + dentalRecordsCount;
                
                // Get last record date
                if (records.length > 0) {
                    const lastRecord = records[0];
                    const date = lastRecord.createdAt ? lastRecord.createdAt.toDate() : new Date();
                    lastRecordDate.textContent = formatShortDate(date);
                } else {
                    lastRecordDate.textContent = 'N/A';
                }
                
                // Reload chart data
                loadChartData(records);
                
                // Update appointments count
                updateDashboardAppointmentCount();
            } catch (error) {
                console.error('Error updating dashboard after delete:', error);
            }
        }
        
        // Helper function to refresh all views
        function refreshAllViews() {
            // Refresh current view
            if (currentView === 'medicalRecords') {
                loadMedicalRecords();
            } else if (currentView === 'dentalRecords') {
                loadDentalRecords();
            } else if (currentView === 'dashboard') {
                loadDashboardData();
            } else if (currentView === 'medicalCertificate') {
                loadCertificateData();
            } else if (currentView === 'createReport') {
                loadReportData();
            } else if (currentView === 'appointmentSchedule') {
                loadAppointments();
                renderCalendar();
            }
        }
        
        async function generateReport() {
            try {
                // Fetch all records
                const snapshot = await db.collection('records').orderBy('createdAt', 'desc').get();
                const records = [];
                snapshot.forEach(doc => {
                    records.push({ id: doc.id, ...doc.data() });
                });
                
                if (records.length === 0) {
                    showAlert('info', 'No Data', 'No records found to generate report.');
                    return;
                }
                
                // Calculate statistics
                const totalRecordsCount = records.length;
                const medicalCount = records.filter(r => r.categoryType === 'Medical').length;
                const dentalCount = records.filter(r => r.categoryType === 'Dental').length;
                const consultationCount = records.filter(r => r.categoryType === 'Consultation').length;
                const emergencyCount = records.filter(r => r.categoryType === 'Emergency').length;
                
                const maleCount = records.filter(r => r.sex === 'Male').length;
                const femaleCount = records.filter(r => r.sex === 'Female').length;
                
                const studentCount = records.filter(r => r.patientType === 'Student').length;
                const facultyCount = records.filter(r => r.patientType === 'Faculty').length;
                const staffCount = records.filter(r => r.patientType === 'Staff').length;
                
                // Populate report summary
                reportSummary.innerHTML = `
                    <div class="summary-item">
                        <div class="summary-value">${totalRecordsCount}</div>
                        <div class="summary-label">Total Records</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${medicalCount}</div>
                        <div class="summary-label">Medical</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${dentalCount}</div>
                        <div class="summary-label">Dental</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${consultationCount + emergencyCount}</div>
                        <div class="summary-label">Consultation/Emergency</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${maleCount}</div>
                        <div class="summary-label">Male</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${femaleCount}</div>
                        <div class="summary-label">Female</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${studentCount}</div>
                        <div class="summary-label">Students</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${facultyCount + staffCount}</div>
                        <div class="summary-label">Faculty/Staff</div>
                    </div>
                `;
                
                // Populate report table
                printReportTableBody.innerHTML = '';
                records.forEach(record => {
                    const date = record.createdAt ? record.createdAt.toDate() : new Date();
                    const formattedDate = formatShortDate(date);
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${record.name}</td>
                        <td>${record.sex}</td>
                        <td>${record.categoryType}</td>
                        <td>${record.age}</td>
                        <td>${record.department}</td>
                        <td>${formattedDate}</td>
                    `;
                    printReportTableBody.appendChild(row);
                });
                
                // Set report title and date
                reportTitle.textContent = 'Health Records Report';
                reportGenerationDate.textContent = formatDate(new Date());
                
                // Show report modal
                reportModal.classList.remove('hidden');
            } catch (error) {
                console.error('Error generating report:', error);
                showAlert('error', 'Report Error', 'Error generating report: ' + error.message);
            }
        }
        
        // ===== Print Functions =====
        function printCertificate() {
            const printWindow = window.open('', '_blank');

            printWindow.document.write(`
<!DOCTYPE html>
<html>
<head>
    <title>Medical Certificate</title>
    <style>
        @page {
            size: A4 portrait;
            margin: 8mm;
        }

        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: #000;
            margin: 0;
            padding: 0;
        }

        .certificate-container {
            padding: 8mm;
            max-width: 100%;
        }

        .certificate-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #000;
        }

        .university-logo {
            width: 70px;
            height: 70px;
            margin-right: 15px;
        }

        .university-info {
            flex-grow: 1;
            text-align: center;
        }

        .university-info h1 {
            font-size: 22px;
            margin: 0;
            font-weight: bold;
        }

        .university-info p {
            font-size: 13px;
            margin: 2px 0;
        }

        .certificate-title {
            text-align: center;
            margin: 25px 0;
            text-transform: uppercase;
            font-weight: 700;
            font-size: 18px;
        }

        .certificate-body {
            margin: 20px 0;
            font-size: 14px;
            line-height: 1.8;
        }

        /* SIMPLE TEXT SECTIONS */
        .non-editable-section,
        .editable-section {
            background: none;
            padding: 0;
            margin-bottom: 15px;
            border: none;
            border-radius: 0;
        }

        .editable-section p {
            margin-bottom: 10px;
        }

        .certificate-footer {
            margin-top: 50px;
            text-align: center;
        }

        .signature {
            border-top: 1px solid #000;
            width: 220px;
            margin: 0 auto;
            padding-top: 8px;
            font-size: 13px;
        }
    </style>
</head>

<body>
    <div class="certificate-container">
        <div class="certificate-header">
            <div class="university-logo">
                <img src="https://wxyzofficial.sirv.com/USC-Election/ssu.jpg"
                     style="width:100%;height:100%;object-fit:contain;">
            </div>
            <div class="university-info">
                <h1>SAMAR STATE UNIVERSITY</h1>
                <p>Catbalogan City, Samar</p>
                <p>SSU CARE & WELLNESS SERVICES  UNIVERSITY CLINIC</p>
            </div>
        </div>

        <div class="certificate-title">MEDICAL CERTIFICATE</div>

        <div class="certificate-body">
            <div class="non-editable-section">
                <p>To whom it may concern:</p>
                <p>
                    This is to certify that
                    <strong>${certPatientName.textContent}</strong>,
                    <strong>${certPatientAge.textContent}</strong> years old,
                    a <strong>${certPatientCourse.textContent}</strong>,
                    was examined at the SSU Care & Wellness Services  University Clinic
                    on <strong>${certExamDate.textContent}</strong>.
                </p>
            </div>

            <div class="editable-section">
                <p><strong>Diagnosis:</strong> ${editableDiagnoses.value || '_____________________________'}</p>
                <p><strong>Medicine:</strong> ${editableMedicine.value || '_____________________________'}</p>
                <p><strong>Remarks:</strong> ${editableRemarks.value || '_____________________________'}</p>
            </div>

            <p>
                This certificate is issued upon the request of the patient for whatever
                legal purpose it may serve.
            </p>
        </div>

        <div class="certificate-footer">
            <div class="signature">
                <strong>Dr. Maria Santos</strong><br>
                <em>University Physician</em><br>
                <em>Samar State University</em>
            </div>
        </div>
    </div>
</body>
</html>
            `);

            printWindow.document.close();
            printWindow.focus();

            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
        }
        
        function printPatientRecord() {
            const printWindow = window.open('', '_blank');

            printWindow.document.write(`
<!DOCTYPE html>
<html>
<head>
    <title>Individual Patient Record</title>
    <style>
        @page {
            size: A4 portrait;
            margin: 8mm; /* NARROW */
        }

        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.5;
            color: #000;
            margin: 0;
            padding: 0;
            font-size: 13px;
        }

        .patient-view-container {
            padding: 8mm;
            max-width: 100%;
            page-break-inside: avoid;
        }

        /* HEADER */
        .patient-view-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #000;
        }

        .university-logo {
            width: 60px;
            height: 60px;
            margin-right: 12px;
        }

        .university-info {
            flex-grow: 1;
            text-align: center;
        }

        .university-info h1 {
            font-size: 20px;
            margin: 0;
            font-weight: bold;
        }

        .university-info p {
            font-size: 12px;
            margin: 2px 0;
        }

        /* TITLE */
        .patient-view-title {
            text-align: center;
            margin: 12px 0;
            font-weight: 700;
            font-size: 16px;
        }

        /* PRIVACY NOTICE (COMPACT) */
        .privacy-notice {
            font-size: 11px;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
        }

        /* PATIENT DETAILS */
        .certificate-details {
            margin: 10px 0;
        }

        .detail-row {
            display: flex;
            margin-bottom: 6px;
            padding-bottom: 4px;
            border-bottom: 1px dotted #aaa;
        }

        .detail-label {
            font-weight: 600;
            width: 160px;
        }

        .detail-value {
            flex-grow: 1;
        }

        /* MEDICAL DETAILS  FIXED HEIGHT TO PREVENT PAGE 2 */
        .medical-details-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
            page-break-inside: avoid;
        }

        .medical-column {
            border: 1px solid #000;
            padding: 8px;
            page-break-inside: avoid;
        }

        .medical-column h4 {
            font-size: 13px;
            margin: 0 0 6px;
            padding-bottom: 4px;
            border-bottom: 1px solid #000;
        }

        .medical-column-content {
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 120px;   /* HARD LIMIT */
            overflow: hidden;    /* FORCE 1 PAGE */
        }

        /* FOOTER */
        .footer {
            text-align: center;
            margin-top: 12px;
            padding-top: 6px;
            border-top: 1px solid #000;
            font-size: 11px;
        }
    </style>
</head>

<body>
    <div class="patient-view-container">
        <div class="patient-view-header">
            <div class="university-logo">
                <img src="https://wxyzofficial.sirv.com/USC-Election/ssu.jpg"
                     style="width:100%;height:100%;object-fit:contain;">
            </div>
            <div class="university-info">
                <h1>SAMAR STATE UNIVERSITY</h1>
                <p>Catbalogan City, Samar</p>
                <p>SSU CARE & WELLNESS SERVICES  UNIVERSITY CLINIC</p>
            </div>
        </div>

        <div class="patient-view-title">INDIVIDUAL PATIENT RECORD</div>

        <div class="privacy-notice">
            <strong>Privacy Notice:</strong>
            This document contains confidential personal and medical information
            protected by data privacy laws and regulations.
        </div>

        <div class="certificate-details">
            <div class="detail-row"><div class="detail-label">Patient Name:</div><div class="detail-value">${viewPatientName.textContent}</div></div>
            <div class="detail-row"><div class="detail-label">Age:</div><div class="detail-value">${viewPatientAge.textContent}</div></div>
            <div class="detail-row"><div class="detail-label">Sex:</div><div class="detail-value">${viewPatientSex.textContent}</div></div>
            <div class="detail-row"><div class="detail-label">Civil Status:</div><div class="detail-value">${viewCivilStatus.textContent}</div></div>
            <div class="detail-row"><div class="detail-label">Birthday:</div><div class="detail-value">${viewPatientBirthday.textContent}</div></div>
            <div class="detail-row"><div class="detail-label">Contact Number:</div><div class="detail-value">${viewPatientContact.textContent}</div></div>
            <div class="detail-row"><div class="detail-label">Department:</div><div class="detail-value">${viewPatientDepartment.textContent}</div></div>
            <div class="detail-row"><div class="detail-label">Course:</div><div class="detail-value">${viewPatientCourse.textContent}</div></div>
            <div class="detail-row"><div class="detail-label">Address:</div><div class="detail-value">${viewPatientAddress.textContent}</div></div>
            <div class="detail-row"><div class="detail-label">Guardian:</div><div class="detail-value">${viewPatientGuardian.textContent}</div></div>
            <div class="detail-row"><div class="detail-label">Emergency Contact:</div><div class="detail-value">${viewEmergencyContact.textContent}</div></div>
        </div>

        <div class="medical-details-grid">
            <div class="medical-column">
                <h4>Complaint</h4>
                <div class="medical-column-content">${viewComplaint.textContent}</div>
            </div>
            <div class="medical-column">
                <h4>Diagnostic / Diagnoses</h4>
                <div class="medical-column-content">${viewDiagnoses.textContent}</div>
            </div>
            <div class="medical-column">
                <h4>Treatment & Remarks</h4>
                <div class="medical-column-content">${viewTreatment.textContent}</div>
            </div>
        </div>

        <div class="footer">
            <em>Generated on: ${new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            })}</em>
        </div>
    </div>
</body>
</html>
            `);

            printWindow.document.close();
            printWindow.focus();

            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
        }
        
        function printReport() {
            const printWindow = window.open('', '_blank');

            printWindow.document.write(`
<!DOCTYPE html>
<html>
<head>
    <title>Health Records Report</title>
    <style>
        @page {
            size: A4 landscape;
            margin: 8mm;
        }

        body {
            font-family: Arial, sans-serif;
            margin: 0;
            color: #202124;
            font-size: 12px;
        }

        .report-container {
            padding: 8mm;
        }

        /* HEADER */
        .report-header {
            position: relative;
            text-align: center;
            margin-bottom: 10px;
        }

        .report-logo {
            position: absolute;
            left: 0;
            top: 0;
            width: 55px;
            height: 55px;
        }

        .report-header h1 {
            margin: 0;
            font-size: 22px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        .report-header h2 {
            margin: 4px 0;
            font-size: 18px;
            color: #1a73e8;
            font-weight: 600;
        }

        .report-header p {
            margin: 4px 0 10px;
            font-size: 12px;
        }

        .divider {
            height: 2px;
            background: #1a73e8;
            margin-bottom: 15px;
        }

        /* SUMMARY PANEL */
        .report-summary {
            background: #eaf2ff;
            border-radius: 10px;
            padding: 16px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 18px;
        }

        .summary-item {
            text-align: center;
        }

        .summary-value {
            font-size: 22px;
            font-weight: 700;
            color: #1a73e8;
        }

        .summary-label {
            font-size: 12px;
            color: #5f6368;
        }

        /* TABLE */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            font-size: 12px;
            padding: 10px 6px;
            border-bottom: 2px solid #dadce0;
        }

        td {
            font-size: 12px;
            padding: 10px 6px;
            border-bottom: 1px solid #dadce0;
        }

        tr {
            page-break-inside: avoid;
        }
        
        .certificate-footer {
            margin-top: 50px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="report-container">

        <div class="report-header">
            <div class="report-logo">
                <img src="https://wxyzofficial.sirv.com/USC-Election/ssu.jpg"
                     style="width:100%;height:100%;object-fit:contain;">
            </div>

            <h1>SAMAR STATE UNIVERSITY</h1>
            <h2>Health Records Report</h2>
            <p>Generated on: ${reportGenerationDate.textContent}</p>
        </div>

        <div class="divider"></div>

        <div class="report-summary">
            ${reportSummary.innerHTML}
        </div>

        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Sex</th>
                    <th>Category</th>
                    <th>Age</th>
                    <th>Department</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                ${Array.from(printReportTableBody.querySelectorAll('tr'))
                    .map(row => row.outerHTML)
                    .join('')}
            </tbody>
        </table>
        <br>
        <div class="certificate-footer">
            <div class="signature">
                <strong>Dr. Maria Santos</strong><br>
                <em>University Physician</em><br>
                <em>Samar State University</em>
            </div>
        </div>
    </div>
</body>
</html>
            `);

            printWindow.document.close();
            printWindow.focus();

            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
        }
        
        // ===== Event Listeners =====
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date and time
            updateDateTime();
            
            // Set form dates
            const now = new Date();
            formDate.textContent = formatDate(now);
            recordDate.value = formatDate(now);
            
            // Auth form events
            authForm.addEventListener('submit', handleAuthSubmit);
            googleSignIn.addEventListener('click', handleGoogleSignIn);
            authToggleLink.addEventListener('click', function(e) {
                e.preventDefault();
                toggleAuthMode();
            });
            
            // Navigation events
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    showView(this.dataset.view);
                });
            });
            
            // Logout event
            logoutBtn.addEventListener('click', handleLogout);
            
            // Record form events
            recordForm.addEventListener('submit', submitRecordForm);
            
            // Photo upload event for add record
            photoUpload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        photoBase64 = event.target.result;
                        photoPreview.innerHTML = `<img src="${photoBase64}" alt="Patient Photo">`;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Photo upload event for update record
            updatePhotoUpload.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        updatePhotoBase64 = event.target.result;
                        updatePhotoPreview.innerHTML = `<img src="${updatePhotoBase64}" alt="Patient Photo">`;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Update form events
            updateForm.addEventListener('submit', submitUpdateForm);
            closeUpdateBtn.addEventListener('click', function() {
                updateModal.classList.add('hidden');
            });
            
            // Medical records events
            entriesSelect.addEventListener('change', function() {
                medicalEntriesPerPage = parseInt(this.value);
                medicalCurrentPage = 1;
                renderMedicalTable();
            });
            
            searchMedical.addEventListener('input', function() {
                medicalCurrentPage = 1;
                renderMedicalTable();
            });
            
            medicalPrevBtn.addEventListener('click', function() {
                if (medicalCurrentPage > 1) {
                    medicalCurrentPage--;
                    renderMedicalTable();
                }
            });
            
            medicalNextBtn.addEventListener('click', function() {
                const totalPages = Math.ceil(medicalRecords.length / medicalEntriesPerPage);
                if (medicalCurrentPage < totalPages) {
                    medicalCurrentPage++;
                    renderMedicalTable();
                }
            });
            
            // Dental records events
            dentalEntriesSelect.addEventListener('change', function() {
                dentalEntriesPerPage = parseInt(this.value);
                dentalCurrentPage = 1;
                renderDentalTable();
            });
            
            searchDental.addEventListener('input', function() {
                dentalCurrentPage = 1;
                renderDentalTable();
            });
            
            dentalPrevBtn.addEventListener('click', function() {
                if (dentalCurrentPage > 1) {
                    dentalCurrentPage--;
                    renderDentalTable();
                }
            });
            
            dentalNextBtn.addEventListener('click', function() {
                const totalPages = Math.ceil(dentalRecords.length / dentalEntriesPerPage);
                if (dentalCurrentPage < totalPages) {
                    dentalCurrentPage++;
                    renderDentalTable();
                }
            });
            
            // Appointment events
            newAppointmentBtn.addEventListener('click', () => {
                newAppointmentModal.classList.remove('hidden');
                // Set default date to today
                document.getElementById('appointmentDate').value = 
                    new Date().toISOString().split('T')[0];
            });
            
            closeNewAppointmentBtn.addEventListener('click', () => {
                newAppointmentModal.classList.add('hidden');
                newAppointmentForm.reset();
            });
            
            newAppointmentForm.addEventListener('submit', scheduleNewAppointment);
            
            closeUpdateAppointmentBtn.addEventListener('click', () => {
                updateAppointmentModal.classList.add('hidden');
                updateAppointmentForm.reset();
            });
            
            updateAppointmentForm.addEventListener('submit', updateAppointmentFormSubmit);
            
            prevMonthBtn.addEventListener('click', () => {
                currentCalendarMonth--;
                if (currentCalendarMonth < 0) {
                    currentCalendarMonth = 11;
                    currentCalendarYear--;
                }
                renderCalendar();
            });
            
            nextMonthBtn.addEventListener('click', () => {
                currentCalendarMonth++;
                if (currentCalendarMonth > 11) {
                    currentCalendarMonth = 0;
                    currentCalendarYear++;
                }
                renderCalendar();
            });
            
            searchAppointments.addEventListener('input', renderAppointmentsTable);
            
            // Medical Certificate events
            standardCertificateOption.addEventListener('click', function() {
                standardCertificateOption.classList.add('active');
                individualReportOption.classList.remove('active');
                standardCertificateSection.classList.remove('hidden');
                individualReportSection.classList.add('hidden');
                certificateType = 'standard';
            });
            
            individualReportOption.addEventListener('click', function() {
                individualReportOption.classList.add('active');
                standardCertificateOption.classList.remove('active');
                individualReportSection.classList.remove('hidden');
                standardCertificateSection.classList.add('hidden');
                certificateType = 'individual';
            });
            
            searchCertificate.addEventListener('input', function() {
                loadCertificateData();
            });
            
            searchIndividualReport.addEventListener('input', function() {
                loadCertificateData();
            });
            
            // Report events
            reportSearch.addEventListener('input', function() {
                loadReportData();
            });
            
            generateReportBtn.addEventListener('click', generateReport);
            
            // Patient View Modal events
            closePatientViewBtn.addEventListener('click', function() {
                patientViewModal.classList.add('hidden');
            });
            printPatientRecordBtn.addEventListener('click', printPatientRecord);
            
            // Certificate events
            yearSelector.addEventListener('change', function() {
                loadChartData(allRecords);
            });
            
            printCertificateBtn.addEventListener('click', printCertificate);
            
            closeCertificateBtn.addEventListener('click', function() {
                certificateModal.classList.add('hidden');
            });
            
            // Report modal events
            printReportBtn.addEventListener('click', printReport);
            closeReportBtn.addEventListener('click', function() {
                reportModal.classList.add('hidden');
            });
            
            // Close modals when clicking outside
            [patientViewModal, certificateModal, updateModal, alertModal, reportModal, 
             newAppointmentModal, updateAppointmentModal].forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        modal.classList.add('hidden');
                    }
                });
            });
            
            // Firebase auth state observer
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    
                    // Get user data from Firestore
                    const userDoc = await db.collection('users').doc(user.uid).get();
                    const userData = userDoc.data();
                    
                    // Update UI with user info
                    const displayName = userData ? userData.name : user.displayName || 'Admin';
                    const email = user.email;
                    const initials = displayName.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                    
                    userName.textContent = displayName;
                    userEmail.textContent = email;
                    userAvatar.textContent = initials;
                    
                    // Switch to app view
                    authScreen.classList.add('hidden');
                    appContainer.classList.remove('hidden');
                    
                    // Load initial data
                    loadDashboardData();
                } else {
                    // User is signed out
                    currentUser = null;
                    authScreen.classList.remove('hidden');
                    appContainer.classList.add('hidden');
                }
            });
        });

        // Make functions globally available for onclick events
        window.viewPatientRecord = viewPatientRecord;
        window.updateRecord = updateRecord;
        window.deleteRecord = deleteRecord;
        window.generateStandardCertificate = generateStandardCertificate;
        window.generateIndividualReport = generateIndividualReport;
        window.viewAppointment = viewAppointment;
        window.openUpdateAppointment = openUpdateAppointment;
        window.deleteAppointment = deleteAppointment;

        // Initial call to update time
        updateDateTime();
    </script>
</body>
</html>